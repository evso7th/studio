(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[833],{157:(e,r,i)=>{"use strict";i.d(r,{A:()=>s});var t=i(2115);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return r.filter((e,r,i)=>!!e&&""!==e.trim()&&i.indexOf(e)===r).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)((e,r)=>{let{color:i="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:m,...p}=e;return(0,t.createElement)("svg",{ref:r,...n,width:a,height:a,stroke:i,strokeWidth:s?24*Number(l)/Number(a):l,className:o("lucide",c),...p},[...m.map(e=>{let[r,i]=e;return(0,t.createElement)(r,i)}),...Array.isArray(d)?d:[d]])}),s=(e,r)=>{let i=(0,t.forwardRef)((i,n)=>{let{className:s,...c}=i;return(0,t.createElement)(l,{ref:n,iconNode:r,className:o("lucide-".concat(a(e)),s),...c})});return i.displayName="".concat(e),i}},599:(e,r,i)=>{"use strict";i.r(r),i.d(r,{default:()=>eE});var t={};i.r(t),i.d(t,{c5:()=>W,Xq:()=>B,BM:()=>G,Io:()=>H,MA:()=>K,PS:()=>Y,oL:()=>q,wW:()=>s,gB:()=>u,R2:()=>d,ep:()=>c,Cb:()=>C,A1:()=>Z,ey:()=>T,Pg:()=>z,fJ:()=>V,Be:()=>D,fL:()=>X,nO:()=>k,BK:()=>R,Oy:()=>j,Vg:()=>F,YT:()=>N,cz:()=>O,Ox:()=>l,$6:()=>P,Fg:()=>g,eb:()=>h,V9:()=>S,eN:()=>b,JP:()=>A,pc:()=>x,ll:()=>L,yd:()=>M,zn:()=>w,wI:()=>_,PA:()=>f,IU:()=>U,Xn:()=>m,J2:()=>p,Tc:()=>$,OF:()=>v,LF:()=>J,yJ:()=>I,uX:()=>y,Fy:()=>E,wN:()=>Q});var a=i(5155),o=i(2115),n=i(5695);let l=1e3,s=500,c=300,d=500,m=1,p=0,h=30,g=80,u=20,f=130,v=24,y=250,x=200,w=200,_=400,T=50,A=.75,S=0,b=1,E=10,L=.25,M=.15,C=550,P=1.25,I=.92,O=48,k=48,z=24,R="/assets/images/bearface.png",j="/assets/images/bearface.png",F="/assets/images/bearface_dark.png",V=.4,D=5e3,X=5e3,N=5e3,G=7e3,W=7e3,H=12e3,B=1e4,U="/assets/images/platform_grass.png",$="/assets/images/platform_ice.png",J="/assets/images/platform_stone.png",K="/assets/images/level1_bkg.png",Y="/assets/images/level2_bkg.png",q="/assets/images/level3_bkg.png",Z=80,Q={idle:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80},run:{src:"/assets/images/hero_jeans3.png",frames:1,fps:10,width:30,height:80},jump:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80}};var ee=i(940);let er=(-.4+Math.sqrt(.4*.4+3.2*y))/2,ei=e=>p,et={id:"hero",x:0,y:0,width:h,height:g,velocity:{x:0,y:0},action:"idle",isOnPlatform:!0,platformId:"platform_ground",currentSpeedX:0,facingDirection:"right",animations:Q,currentFrame:0,frameTime:0,slideVelocityX:0,isArmored:!1,armorTimer:0,armorCooldownTimer:0,armorRemainingTime:0},ea=(e,r,i)=>{let t=ei(r),a=A,o=!1,n=!1,l=U,s=U,c="/assets/images/groundfloor.png";return 1===i?(l=U,s=U,c="/assets/images/groundfloor.png"):2===i?(a=.75,o=!0,n=!0,l=$,s=$,c=$):3===i&&(a=.75,o=!1,n=!0,l=J,s=J,c=J),[{id:"platform_ground",x:-100,y:t,width:e+200,height:m,isMoving:!1,speed:0,direction:1,moveAxis:"x",imageSrc:c},{id:"platform1",x:e*S-(1===S?f:0),y:t+m+w,width:f,height:v,isMoving:!0,speed:a,direction:1===S?-1:1,moveAxis:"x",moveRange:{min:0,max:e-f},imageSrc:l,isSlippery:o},{id:"platform2",x:e*b-(1===b?f:0),y:t+m+_,width:f,height:v,isMoving:!0,speed:a,direction:1===b?-1:1,moveAxis:"x",moveRange:{min:0,max:e-f},imageSrc:s,isSlippery:n}]},eo=(e,r,i,t)=>{let a=[],o=t.find(e=>"platform1"===e.id),n=t.find(e=>"platform2"===e.id),l=r/2-k/2;if(o&&n){let e=o.y+o.height;l=e+(n.y-e)/2-k/2}if(2===i)a.push({id:"enemy_level2_0",enemyId:"enemy1",x:e/2-O/2,y:l,width:O,height:k,imageSrc:R,speed:V,direction:1,moveAxis:"x",moveRange:{min:0,max:e-O},collisionRadius:z,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:N});else if(3===i&&(a.push({id:"enemy_level3_0",enemyId:"enemy1",x:e/3-O/2,y:l,width:O,height:k,imageSrc:j,speed:V,direction:1,moveAxis:"x",moveRange:{min:0,max:e-O},collisionRadius:z,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:N}),n)){let r=n.y+n.height+T;a.push({id:"enemy_level3_1",enemyId:"enemy2",x:2*e/3-O/2,y:r,width:O,height:k,imageSrc:F,speed:V,direction:-1,moveAxis:"x",moveRange:{min:0,max:e-O},collisionRadius:z,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:N})}return a};function en(e,r,i,t){let a,o;if(!e.width||!e.height||0===t.length)return[];let n=[];ei(e.height);let l=C-r;x>=(l=Math.min(l,e.height-r))&&(console.warn("Coin spawn zone is invalid. Min:",x,"Max:",l,"GameArea H:",e.height,"CoinSize:",r,"MAX_COIN_SPAWN_Y_FROM_CP_TOP:",C),(l=x+r)+r>e.height-1&&(l=e.height-r-1-r)<x&&(l=x));let s=Math.max(0,l-x),c=e.width*L,m=Math.max(20,e.height*M),p=Math.random()*(e.width-r),h=x+(s>0?Math.random()*s:0);n.push({id:"coin_p".concat(i,"_0_").concat(Date.now()),x:p,y:h,width:r,height:r,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!0,spawnExplosionProgress:0,pairId:i,isPendingSpawn:!1,spawnDelayMs:0});let g=0;do a=Math.random()*(e.width-r),o=x+(s>0?Math.random()*s:0),g++;while((Math.abs(a-p)<c||Math.abs(o-h)<m)&&g<20);return n.push({id:"coin_p".concat(i,"_1_").concat(Date.now()),x:a,y:o,width:r,height:r,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!1,spawnExplosionProgress:0,pairId:i,isPendingSpawn:!0,spawnDelayMs:d}),n}let el=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=ei(r),a=ea(e,r,i),o=eo(e,r,i,a),n=A;(2===i||3===i)&&(n=.75);let l=a.map(e=>e.isMoving?{...e,speed:n}:e),s=2===i?G:3===i?H:0;return{hero:{...et,x:e/2-et.width/2,y:t+m,currentSpeedX:0,isArmored:2===i||3===i,armorTimer:s,armorCooldownTimer:0,armorRemainingTime:Math.ceil(s/1e3)},platforms:l,activeCoins:en({width:e,height:r},u,0,l),enemies:o,score:0,currentLevel:i,gameOver:!1,gameLost:!1,gameArea:{width:e,height:r},isGameInitialized:!1,paddingTop:0,heroAppearance:"appearing",heroAppearElapsedTime:0,totalCoinsCollectedInLevel:0,currentPairIndex:0,levelCompleteScreenActive:!1,showDebugLevelComplete:!1,bearVoicePlayedForLevel:!1}},es=el(void 0,void 0,1);function ec(e,r){var i,t,a,o,n,d,p,h,g;switch(r.type){case"MOVE_LEFT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:-P,action:"run_left",facingDirection:"left",slideVelocityX:0}};return e;case"MOVE_LEFT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX<0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(t=null===(i=e.hero.velocity)||void 0===i?void 0:i.y)&&void 0!==t?t:0)===0?"idle":e.hero.action}};return e;case"MOVE_RIGHT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:P,action:"run_right",facingDirection:"right",slideVelocityX:0}};return e;case"MOVE_RIGHT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX>0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(o=null===(a=e.hero.velocity)||void 0===a?void 0:a.y)&&void 0!==o?o:0)===0?"idle":e.hero.action}};return e;case"JUMP":if("visible"===e.heroAppearance&&e.hero.isOnPlatform&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return ee.W.playSound("Hero_jump1"),{...e,hero:{...e.hero,velocity:{...e.hero.velocity,y:er},isOnPlatform:!1,platformId:null,action:"jump_up"}};return e;case"UPDATE_GAME_AREA":{let{width:i,height:t,paddingTop:a}=r.payload;if(i<=0||t<=0)return e;let o=e.isGameInitialized?e.currentLevel:es.currentLevel||1,n=ea(i,t,o),s=eo(i,t,o,n),c=e.hero;c=e.isGameInitialized?{...e.hero,x:i/2-e.hero.width/2,y:ei(t)+m,action:"idle",velocity:{x:0,y:0},isOnPlatform:!0,platformId:"platform_ground",isArmored:e.hero.isArmored,armorTimer:e.hero.armorTimer,armorCooldownTimer:e.hero.armorCooldownTimer,armorRemainingTime:e.hero.armorRemainingTime}:{...et,x:i/2-et.width/2,y:ei(t)+m,isArmored:2===o||3===o,armorTimer:2===o?G:3===o?H:0,armorRemainingTime:Math.ceil((2===o?G:3===o?H:0)/1e3)};let d=e.activeCoins;return e.isGameInitialized&&e.gameArea.width===i&&e.gameArea.height===t||(d=en({width:i,height:t},u,0,n)),{...e,gameArea:{width:i,height:t},paddingTop:a,hero:c,platforms:n,enemies:s,activeCoins:d,score:e.isGameInitialized?e.score:0,totalCoinsCollectedInLevel:e.isGameInitialized?e.totalCoinsCollectedInLevel:0,currentPairIndex:e.isGameInitialized?e.currentPairIndex:0,isGameInitialized:!0,bearVoicePlayedForLevel:!!e.isGameInitialized&&e.bearVoicePlayedForLevel,heroAppearance:e.isGameInitialized?"visible":"appearing",heroAppearElapsedTime:e.isGameInitialized?l:0}}case"RESTART_LEVEL":{let{width:r,height:i}=e.gameArea;return{...el(r,i,e.currentLevel),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"NEXT_LEVEL":{let r=e.currentLevel+1;if(r>3)return ee.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};let{width:i,height:t}=e.gameArea;return{...el(i,t,r),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_WON":return ee.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};case"SET_DEBUG_LEVEL_COMPLETE":return{...e,levelCompleteScreenActive:r.payload,showDebugLevelComplete:r.payload};case"SET_DEBUG_LEVEL":{let{width:i,height:t}=e.gameArea,a=el(i,t,r.payload);return es=a,{...a,isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_TICK":{if(!e.isGameInitialized||e.levelCompleteScreenActive||e.gameLost||e.gameOver)return e;let{deltaTime:i}=r.payload,{hero:t,platforms:a,activeCoins:o,enemies:f,score:v,totalCoinsCollectedInLevel:y,currentPairIndex:x,bearVoicePlayedForLevel:T}=e,A=e.gameArea,S=e.heroAppearance,b=e.heroAppearElapsedTime,L=a.map(e=>({...e})),M={...t,velocity:{...t.velocity},animations:{...t.animations}},C=o.map(e=>({...e})),O=[...f.map(e=>({...e}))],k=v,z=y,R=x,j=!1,F=!1,V=!1,U=T,$=!1;(2===e.currentLevel||3===e.currentLevel)&&(M.isArmored?(M.armorTimer-=i,M.armorTimer<=0&&(M.isArmored=!1,M.armorTimer=0,M.armorCooldownTimer=2===e.currentLevel?W:B)):(M.armorCooldownTimer-=i,M.armorCooldownTimer<=0&&(M.isArmored=!0,M.armorCooldownTimer=0,M.armorTimer=2===e.currentLevel?G:H)),M.armorRemainingTime=Math.ceil(M.armorTimer/1e3));let J="run_left"===M.action||"run_right"===M.action?"run":"jump_up"===M.action||"fall_down"===M.action?"jump":"idle",K=M.animations[J];M.frameTime+=i,K&&M.frameTime>=1e3/K.fps&&(M.frameTime=0,M.currentFrame=(M.currentFrame+1)%K.frames),C=(C=C.map(e=>{let r={...e};if(r.isPendingSpawn&&void 0!==r.spawnDelayMs){let e=r.spawnDelayMs-i;e<=0?($=!0,r={...r,isPendingSpawn:!1,spawnDelayMs:0,isSpawning:!0,spawnExplosionProgress:0}):r.spawnDelayMs=e}if(r.isSpawning){let e=(r.spawnExplosionProgress||0)+i/c;e>=1?(r.isSpawning=!1,r.spawnExplosionProgress=1):r.spawnExplosionProgress=e}return r})).map(e=>{if(e.isExploding&&e.collected){let r=(e.explosionProgress||0)+i/s;return r>=1?{...e,isExploding:!1,explosionProgress:1}:{...e,explosionProgress:r}}return e});let Y=ei(A.height);if(L=L.map(e=>{if("platform_ground"===e.id)return{...e,y:Y};if(e.isMoving&&"platform_ground"!==e.id){let r=e.x,t=e.speed,a=t*e.direction;"x"===e.moveAxis&&e.moveRange&&((r+=i/(1e3/60)*a)<=e.moveRange.min||r+e.width>=e.moveRange.max+e.width)&&(e.direction*=-1,a*=-1,r=Math.max(e.moveRange.min,Math.min(r,e.moveRange.max)));let o=Y+m+("platform1"===e.id?w:_);return{...e,x:r,y:o,velocity:{x:a,y:0},speed:t}}return{...e,velocity:{x:0,y:0}}}),O=O.map(r=>{let t={...r},a=e.enemies.find(e=>e.id===r.id);if(t.isDefeated&&void 0!==t.defeatTimer){let e=t.defeatTimer-i;if(!(e<=0))return{...t,defeatTimer:e};t={...t,isDefeated:!1,defeatTimer:0,x:A.width/2-t.width/2,y:t.y,direction:1,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:N},a&&a.isDefeated&&!t.isDefeated&&ee.W.playSound("bear_voice")}if(t.isFrozen&&void 0!==t.frozenTimer){let e=t.frozenTimer-i;if(!(e<=0))return{...t,frozenTimer:e};t={...t,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:N}}if(!t.isDefeated&&!t.isFrozen&&void 0!==t.periodicFreezeIntervalTimer){let e=t.periodicFreezeIntervalTimer-i;if(e<=0)return{...t,isFrozen:!0,frozenTimer:X,periodicFreezeIntervalTimer:N};t={...t,periodicFreezeIntervalTimer:e}}if(!t.isDefeated&&!t.isFrozen){let e=t.x,r=t.speed,a=r*t.direction;if("x"===t.moveAxis&&t.moveRange&&((e+=i/(1e3/60)*a)<=t.moveRange.min||e+t.width>=t.moveRange.max+t.width)){let r=-1*t.direction;a*=-1,e=Math.max(t.moveRange.min,Math.min(e,t.moveRange.max)),t={...t,direction:r}}t={...t,x:e,velocity:{x:a,y:0},speed:r}}return t}),"appearing"===e.heroAppearance)(b+=i)>=l&&(S="visible",b=l,M.action="idle"),M.velocity={x:0,y:0},M.currentSpeedX=0,M.facingDirection=t.facingDirection||"right",M.slideVelocityX=0;else{let r;let t=(null!==(p=null===(n=M.velocity)||void 0===n?void 0:n.y)&&void 0!==p?p:0)-i/(1e3/60)*.4;t=Math.max(t,-8);let a=0,o=!1;if(M.isOnPlatform&&M.platformId){let e=L.find(e=>e.id===M.platformId);e&&(e.isMoving&&(null===(h=e.velocity)||void 0===h?void 0:h.x)&&(a=e.velocity.x*(i/(1e3/60))),e.isSlippery&&(o=!0))}let l=0!==M.currentSpeedX?M.currentSpeedX>0?P:-P:0;o?(0!==M.currentSpeedX?M.slideVelocityX=l:(M.slideVelocityX=(M.slideVelocityX||0)*I,.1>Math.abs(M.slideVelocityX||0)&&(M.slideVelocityX=0)),r=M.x+(M.slideVelocityX||0)*(i/(1e3/60))+a):(M.slideVelocityX=0,r=M.x+i/(1e3/60)*l+a);let s=M.y+i/(1e3/60)*t;t<-.2?M.action="fall_down":t>0?M.action="jump_up":0!==M.currentSpeedX&&M.isOnPlatform?M.action="right"===M.facingDirection?"run_right":"run_left":M.isOnPlatform&&(0===M.slideVelocityX||!o)?M.action="idle":M.isOnPlatform&&o&&0!==M.slideVelocityX&&(M.action=M.slideVelocityX>0?"run_right":"run_left");let c=!1,f=null,v=t,y=M.y;for(let e of L){let i=r,t=r+M.width,a=s,o=s+M.height,n=e.y+e.height,l=e.y,d=e.x;if(i<e.x+e.width&&t>d){if(v<=0&&y>=n&&a<=n){s=n,v=0,c=!0,f=e.id,("fall_down"===M.action||"jump_up"===M.action)&&(M.action=0!==M.currentSpeedX?"right"===M.facingDirection?"run_right":"run_left":"idle",e.isSlippery&&0===M.currentSpeedX||e.isSlippery||(M.slideVelocityX=0));break}let r=M.y+M.height;v>0&&r<=l&&o>=l&&(s=l-M.height,v=-.2)}}if(M.x=r,M.y=s,M.velocity={x:null!==(g=null===(d=M.velocity)||void 0===d?void 0:d.x)&&void 0!==g?g:0,y:v},M.isOnPlatform=c,M.platformId=f,M.isOnPlatform){let e=L.find(e=>e.id===M.platformId);(null==e?void 0:e.isSlippery)?0===M.currentSpeedX&&.1>Math.abs(M.slideVelocityX||0)?M.action="idle":Math.abs(M.slideVelocityX||0)>=.1&&(M.action=(M.slideVelocityX||0)>0?"run_right":"run_left"):0===M.currentSpeedX&&0===v?M.action="idle":0!==M.currentSpeedX&&0===v&&(M.action="right"===M.facingDirection?"run_right":"run_left")}else v>0?M.action="jump_up":v<-.2&&(M.action="fall_down");M.x<0&&(M.x=0),M.x+M.width>A.width&&(M.x=A.width-M.width),M.y+M.height>A.height&&(M.y=A.height-M.height,M.velocity&&M.velocity.y>0&&(M.velocity.y=0));for(let r=0;r<O.length;r++){let i=O[r];if(i.isDefeated||i.isFrozen)continue;let t=i.x+i.width/2,a=i.y+i.height/2,o=Math.max(M.x,Math.min(t,M.x+M.width)),n=Math.max(M.y,Math.min(a,M.y+M.height)),l=t-o,s=a-n;if(l*l+s*s<i.collisionRadius*i.collisionRadius){M.isArmored||(V=!0,ee.W.playSound("Hero_fail"));let t=e.enemies.find(e=>e.id===i.id);t&&!t.isDefeated&&ee.W.playSound("bear_voice"),O[r]={...i,isDefeated:!0,defeatTimer:D,isFrozen:!1,frozenTimer:0},M.isArmored&&(V=!1);break}}V&&!M.isArmored&&(M.y=Y+m,M.x=A.width/2-M.width/2,M.velocity={x:0,y:0},M.isOnPlatform=!0,M.platformId="platform_ground",M.action="idle",S="appearing",b=0,M.slideVelocityX=0);let w=!1,_=0;if(!V||V&&M.isArmored){C=C.map(e=>!e.collected&&!e.isExploding&&!e.isSpawning&&!e.isPendingSpawn&&M.x<e.x+e.width&&M.x+M.width>e.x&&M.y<e.y+e.height&&M.y+M.height>e.y?(w=!0,_++,ee.W.playSound("takecoin"),{...e,collected:!0,isExploding:!0,explosionProgress:0}):e);let r=!1;if(w){k+=_;let i=z;if(z+=_,2===e.currentLevel&&0===i&&z>0&&!O.some(e=>"enemy_level2_0"===e.id&&!e.isDefeated)&&!O.find(e=>"enemy_level2_0"===e.id)){let r=eo(A.width,A.height,e.currentLevel,L).find(e=>"enemy_level2_0"===e.id);r&&(U||(ee.W.playSound("bear_voice"),U=!0),O.push(r))}if(3===e.currentLevel&&0===i&&z>0&&0===O.filter(e=>e.id.startsWith("enemy_level3_")&&!e.isDefeated).length){let r=eo(A.width,A.height,e.currentLevel,L),i=!1;r.forEach(e=>{O.some(r=>r.id===e.id)||(O.push(e),i=!0)}),i&&!U&&(ee.W.playSound("bear_voice"),U=!0)}if(2===e.currentLevel)O=O.map(e=>"enemy_level2_0"!==e.id||e.isDefeated?e:{...e,isFrozen:!0,frozenTimer:X});else if(3===e.currentLevel){let e=z%2==0;O=O.map(r=>("enemy1"!==r.enemyId||!e||r.isDefeated)&&("enemy2"!==r.enemyId||e||r.isDefeated)?r:{...r,isFrozen:!0,frozenTimer:X})}let t=C.filter(e=>e.pairId===x);t.length>0&&t.every(e=>e.collected)&&(z<E?(R=x+1,r=!0):(j=!0,ee.W.playSound("allcoins")))}C=C.filter(e=>!(e.collected&&!1===e.isExploding&&1===e.explosionProgress)),r&&(C=[...C,...en(A,u,R,L)],$=!0)}$&&ee.W.playSound("Coin_splash"),!(M.y<0)||j||V&&!M.isArmored||(F=!0,ee.W.playSound("Hero_fail"))}let q=e.gameOver,Z=e.levelCompleteScreenActive;return!j||V&&!M.isArmored||F||(3===e.currentLevel?q=!0:Z=!0),{...e,hero:M,platforms:L,activeCoins:C,enemies:O,score:k,totalCoinsCollectedInLevel:z,currentPairIndex:R,heroAppearance:S,heroAppearElapsedTime:b,gameOver:q,gameLost:F&&!(V&&!M.isArmored),levelCompleteScreenActive:Z,bearVoicePlayedForLevel:U}}case"EXIT_GAME":return{...es=el(e.gameArea.width,e.gameArea.height,1),gameOver:!1,gameLost:!1,levelCompleteScreenActive:!1};default:return e}}var ed=i(285),em=i(157);let ep=(0,em.A)("CircleArrowLeft",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}]]),eh=(0,em.A)("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),eg=(0,em.A)("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),eu=(0,em.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);function ef(e){let{dispatch:r,onExit:i,disabled:t=!1,currentLevel:o}=e,n=e=>{t||r({type:e})},l=e=>{t||r({type:e})},s=e=>{r({type:e})},c="p-3 h-16 w-16 rounded-full text-foreground shadow-lg hover:shadow-xl active:shadow-lg active:translate-y-px transition-all duration-150 ease-in-out",d="disabled:opacity-70 disabled:bg-transparent disabled:border disabled:border-destructive disabled:text-destructive disabled:shadow-none disabled:cursor-not-allowed",m=e=>e?{}:{backgroundImage:"radial-gradient(circle, hsl(var(--destructive)), #e74210, #f48c25 )"};return(0,a.jsxs)("div",{className:"h-full w-full p-2 flex items-center justify-around z-50 touch-manipulation",style:{backgroundImage:(e=>{switch(e){case 1:default:return'url("/assets/images/groundfloor.png")';case 2:return'url("/assets/images/platform_ice.png")';case 3:return'url("/assets/images/platform_metal.png")'}})(o),backgroundSize:"cover",backgroundPosition:"center left",backgroundRepeat:"no-repeat",backgroundColor:"transparent"},"data-ai-hint":"stone texture",children:[(0,a.jsx)(ed.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(t?d:""),style:m(t),onMouseDown:()=>l("MOVE_LEFT_START"),onMouseUp:()=>s("MOVE_LEFT_STOP"),onTouchStart:()=>l("MOVE_LEFT_START"),onTouchEnd:()=>s("MOVE_LEFT_STOP"),"aria-label":"Move Left",disabled:t,children:(0,a.jsx)(ep,{className:"h-12 w-12 text-foreground"})}),(0,a.jsx)(ed.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(t?d:""),style:m(t),onClick:()=>n("JUMP"),"aria-label":"Jump",disabled:t,children:(0,a.jsx)(eh,{className:"h-12 w-12 text-foreground"})}),(0,a.jsx)(ed.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(t?d:""),style:m(t),onMouseDown:()=>l("MOVE_RIGHT_START"),onMouseUp:()=>s("MOVE_RIGHT_STOP"),onTouchStart:()=>l("MOVE_RIGHT_START"),onTouchEnd:()=>s("MOVE_RIGHT_STOP"),"aria-label":"Move Right",disabled:t,children:(0,a.jsx)(eg,{className:"h-12 w-12 text-foreground"})}),(0,a.jsx)(ed.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(t?d:""),style:m(t),onClick:i,"aria-label":"Выход в меню",disabled:t,children:(0,a.jsx)(eu,{className:"h-12 w-12 text-foreground"})})]})}var ev=i(9434);function ey(e){let{x:r,y:i,width:t,height:a,gameAreaHeight:o,paddingTop:n,color:l,heroAction:s,heroFacingDirection:c,appearanceProps:d,shape:m="rect",isHero:p=!1,isPlatform:h=!1,isEnemy:g=!1}=e,u={position:"absolute",left:"".concat(r,"px"),top:"".concat(n+(o-i-a),"px"),width:"".concat(t,"px"),height:"".concat(a,"px"),objectFit:"fill",transition:"opacity 0.2s ease-out, transform 0.2s ease-out, filter 0.2s ease-out"};l&&!g&&(u.backgroundColor=l);let f="";p&&(f="left"===c?"scaleX(-1)":"scaleX(1)");let v="";if((null==d?void 0:d.type)==="heroAppear"){let e=d.progress;u.opacity=e,v="scale(".concat(e,")"),u.transformOrigin="center bottom",u.borderRadius="2px"}else if("circle"===m?u.borderRadius="50%":g||(u.borderRadius="2px"),s)switch(s){case"jump_up":v="scaleY(0.95) translateY(-3px) scaleX(1.05)",u.transition="transform 0.1s ease-out";break;case"fall_down":v="scaleY(1.05) translateY(1px) scaleX(0.95)",u.transition="transform 0.1s ease-in";break;default:v=""}let y="".concat(f," ").concat(v).trim();return y&&(u.transform=y),u}function ex(e){let r,{hero:i,gameAreaHeight:t,paddingTop:o,heroAppearance:n,heroAppearElapsedTime:l,heroAppearanceDuration:s}=e;if(!t&&0!==t)return null;"appearing"===n&&(r={type:"heroAppear",progress:Math.min(1,l/s)});let c=i.animations.idle.src,d=i.animations.run.src,m=i.animations.jump.src,p=c,h="character fantasy";"run_left"===i.action||"run_right"===i.action?(p=d,h="character running"):("jump_up"===i.action||"fall_down"===i.action)&&(p=m,h="character jumping");let g=ey({...i,gameAreaHeight:t,paddingTop:o,heroAction:i.action,heroFacingDirection:i.facingDirection,appearanceProps:r,isHero:!0}),u=[];return i.isArmored&&u.push("hero-armored"),(0,a.jsx)("img",{src:p,alt:"Hero",style:g,className:(0,ev.cn)(u),role:"img","aria-label":"Hero","data-ai-hint":h})}function ew(e){let{platform:r,gameAreaHeight:i,paddingTop:t}=e;if(!i&&0!==i)return null;let o={...ey({...r,gameAreaHeight:i,paddingTop:t,color:void 0,shape:"rect",isPlatform:!0}),backgroundImage:"url(".concat(r.imageSrc||U,")"),backgroundSize:"platform_ground"===r.id?"auto 100%":"100% 100%",backgroundPosition:"platform_ground"===r.id?"left bottom":"center",backgroundRepeat:"platform_ground"===r.id?"repeat-x":"no-repeat",boxShadow:"none",border:"none"},n="grass platform";return r.imageSrc&&(r.imageSrc.includes("groundfloor")?n="stone ground":r.imageSrc.includes("ice")?n="ice platform":r.imageSrc.includes("stone")?n="stone platform":r.imageSrc.includes("grass")&&(n="grass platform")),(0,a.jsx)("div",{style:o,role:"presentation","data-ai-hint":n})}function e_(e){let{coin:r,gameAreaHeight:i,paddingTop:t}=e;if(!i&&0!==i)return null;let o=ey({...r,gameAreaHeight:i,paddingTop:t,shape:"circle"});if(r.isSpawning&&null!=r.spawnExplosionProgress&&r.spawnExplosionProgress<1){let e=[];for(let i=0;i<8;i++){let t=i/8*2*Math.PI+(Math.random()-.5)*.5,o=40*r.spawnExplosionProgress*(.5+.5*Math.random()),n=Math.cos(t)*o,l=Math.sin(t)*o,s={position:"absolute",left:"calc(50% + ".concat(n,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--accent))",borderRadius:"50%",opacity:1-r.spawnExplosionProgress,transform:"scale(".concat(1-r.spawnExplosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,a.jsx)("div",{style:s},"spawn_particle_".concat(i)))}let i={position:"absolute",left:o.left,top:o.top,width:o.width,height:o.height};return(0,a.jsx)("div",{style:i,"aria-label":"Coin Spawning","data-ai-hint":"sparkle effect",children:e})}if(r.isExploding&&r.collected&&null!=r.explosionProgress&&r.explosionProgress<1){let e=[];for(let i=0;i<8;i++){let t=i/8*2*Math.PI+(Math.random()-.5)*.5,o=40*r.explosionProgress*(.5+.5*Math.random()),n=Math.cos(t)*o,l=Math.sin(t)*o,s={position:"absolute",left:"calc(50% + ".concat(n,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--coin-color))",borderRadius:"50%",opacity:1-r.explosionProgress,transform:"scale(".concat(1-r.explosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,a.jsx)("div",{style:s},"collect_particle_".concat(i)))}let i={position:"absolute",left:o.left,top:o.top,width:o.width,height:o.height};return(0,a.jsx)("div",{style:i,"aria-label":"Coin Exploding","data-ai-hint":"gold sparkle",children:e})}return r.collected||r.isSpawning?null:(0,a.jsx)("img",{src:"/assets/images/thankscoin.png",alt:"Coin",className:"animate-rotate-y",style:{...o,transformStyle:"preserve-3d",boxShadow:"2px 2px 3px rgba(0,0,0,0.2), inset 0 0 2px rgba(255,255,255,0.3)"},role:"img","aria-label":"Coin","data-ai-hint":"gold coin"})}function eT(e){let{enemy:r,gameAreaHeight:i,paddingTop:t}=e;if(!i&&0!==i||r.isDefeated&&r.defeatTimer>0)return null;let o=ey({...r,gameAreaHeight:i,paddingTop:t,isEnemy:!0,isDefeated:r.isDefeated});return(0,a.jsx)("img",{src:r.imageSrc,alt:"Enemy",style:o,role:"img","aria-label":"Enemy","data-ai-hint":"enemy2"===r.enemyId?"dark bear face":"bear face"})}var eA=i(6364),eS=i(1575),eb=i(10);function eE(){var e;let r=el(800,600,1),[i,s]=(0,o.useReducer)(ec,r),c=(0,o.useRef)(null),d=(0,o.useRef)(null),m=(0,o.useRef)(),p=(0,n.useRouter)(),[h,g]=(0,o.useState)(!1),[u,f]=(0,o.useState)(!1),[v,y]=(0,o.useState)({width:0,height:0}),[x,w]=(0,o.useState)(Z),[_,T]=(0,o.useState)(!1),[A,S]=(0,o.useState)(48);(0,o.useEffect)(()=>{{let e=navigator.userAgent,r=/YaBrowser/.test(e);T(r),S(r?48+t.YANDEX_BROWSER_BOTTOM_OFFSET:48)}},[]),(0,o.useEffect)(()=>{let e=()=>{if(d.current&&c.current){let e=d.current.clientHeight;w(Z);let r=Math.max(100,e-Z-A);y({width:c.current.clientWidth,height:r})}};e();let r=new ResizeObserver(e);return d.current&&r.observe(d.current),window.addEventListener("resize",e),()=>{d.current&&r.unobserve(d.current),r.disconnect(),window.removeEventListener("resize",e),m.current&&cancelAnimationFrame(m.current),ee.W.stopAllSounds()}},[A]),(0,o.useEffect)(()=>{v.width>0&&v.height>0&&s({type:"UPDATE_GAME_AREA",payload:{width:v.width,height:v.height,paddingTop:0}})},[v,s]),(0,o.useEffect)(()=>{if(i.isGameInitialized){ee.W.stopAllSounds(),ee.W.playSound("New_level");let e={1:"Level1",2:"Level2",3:"Level3"}[i.currentLevel];e&&ee.W.getCurrentPlayingLoop()!==e&&setTimeout(()=>{i.isGameInitialized&&i.currentLevel===parseInt(e.replace("Level",""))&&ee.W.playSound(e)},500)}},[i.currentLevel,i.isGameInitialized]),(0,o.useEffect)(()=>{i.isGameInitialized&&i.activeCoins.length>0&&0===i.currentPairIndex&&i.activeCoins.some(e=>0===e.pairId&&e.isSpawning)},[i.isGameInitialized,i.activeCoins,i.currentPairIndex]);let b=(0,o.useCallback)(()=>{!i.isGameInitialized||!(i.gameArea.width>0)||!(i.gameArea.height>0)||i.levelCompleteScreenActive||i.gameOver||i.gameLost||u||s({type:"GAME_TICK",payload:{deltaTime:1e3/60}}),m.current=requestAnimationFrame(b)},[s,i.isGameInitialized,i.gameArea.width,i.gameArea.height,i.levelCompleteScreenActive,i.gameOver,i.gameLost,u]);(0,o.useEffect)(()=>(u?m.current&&cancelAnimationFrame(m.current):m.current=requestAnimationFrame(b),()=>{m.current&&cancelAnimationFrame(m.current)}),[b,u]),(0,o.useEffect)(()=>{let e=e=>{if(h||"appearing"===i.heroAppearance||i.levelCompleteScreenActive||i.gameLost||i.gameOver||"F5"===e.key||e.ctrlKey&&"r"===e.key.toLowerCase()||e.ctrlKey&&e.shiftKey&&"i"===e.key.toLowerCase()||e.metaKey&&e.altKey&&"i"===e.key.toLowerCase()||"F12"===e.key)return;let r=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":s({type:"MOVE_LEFT_START"}),r=!0;break;case"arrowright":case"d":s({type:"MOVE_RIGHT_START"}),r=!0;break;case"arrowup":case"w":case" ":s({type:"JUMP"}),r=!0}r&&e.preventDefault()},r=e=>{if(h||"appearing"===i.heroAppearance||i.levelCompleteScreenActive||i.gameLost||i.gameOver)return;let r=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":s({type:"MOVE_LEFT_STOP"}),r=!0;break;case"arrowright":case"d":s({type:"MOVE_RIGHT_STOP"}),r=!0}r&&e.preventDefault()};return window.addEventListener("keydown",e),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",r),s({type:"MOVE_LEFT_STOP"}),s({type:"MOVE_RIGHT_STOP"})}},[s,i.heroAppearance,i.levelCompleteScreenActive,i.gameLost,i.gameOver,h]);let E=async()=>{ee.W.stopAllSounds(),ee.W.playSound("exit"),g(!1),f(!1),setTimeout(()=>{p.push("/")},300)},L=()=>{g(!1),f(!1)};return i.gameLost?(0,a.jsxs)("div",{className:"h-screen w-screen flex flex-col items-center justify-center bg-background text-foreground p-4",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold mb-4 text-destructive",children:"Игра окончена!"}),(0,a.jsx)("p",{className:"text-xl mb-8 text-center",children:"Кажется, наш герой немного увлекся полетом..."}),(0,a.jsx)(ed.$,{onClick:()=>{ee.W.stopAllSounds(),s({type:"RESTART_LEVEL"})},size:"lg",className:"text-lg px-8 py-3 bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Начать сначала"}),(0,a.jsx)(ed.$,{onClick:E,variant:"outline",size:"lg",className:"mt-4 text-lg px-8 py-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Главное меню"})]}):i.levelCompleteScreenActive||i.showDebugLevelComplete?(0,a.jsx)(eA.M,{currentLevel:i.currentLevel,onNextLevel:()=>{ee.W.stopAllSounds(),s({type:"NEXT_LEVEL"}),i.showDebugLevelComplete&&s({type:"SET_DEBUG_LEVEL_COMPLETE",payload:!1})}}):i.gameOver&&3===i.currentLevel&&!i.gameLost?(0,a.jsx)(eS.V,{}):(0,a.jsxs)("div",{ref:d,className:"h-screen w-screen flex flex-col overflow-hidden select-none",style:{backgroundColor:"hsl(var(--background))",paddingBottom:"".concat(A,"px"),boxSizing:"border-box"},"aria-label":"Главное окно игры",children:[(0,a.jsxs)("header",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-10 pointer-events-none",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"font-roboto text-2xl font-bold text-white shadow-md",children:"IPO Mad Racing"}),(null===(e=i.hero)||void 0===e?void 0:e.isArmored)&&i.hero.armorRemainingTime>0&&(0,a.jsxs)("p",{className:"text-xs font-normal text-accent font-roboto shadow-md",children:["Броня: ",i.hero.armorRemainingTime,"с"]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Level: ",i.currentLevel]}),(0,a.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Спасибки: ",i.score]})]})]}),(0,a.jsx)("div",{ref:c,className:"relative w-full overflow-hidden flex-grow",style:{backgroundImage:"url(".concat((e=>{switch(e){case 1:default:return K;case 2:return Y;case 3:return q}})(i.currentLevel),")"),backgroundSize:"cover",backgroundPosition:"center center"},"data-ai-hint":"abstract pattern",children:i.isGameInitialized&&v.height>0&&i.hero&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ex,{hero:i.hero,gameAreaHeight:v.height,paddingTop:0,heroAppearance:i.heroAppearance,heroAppearElapsedTime:i.heroAppearElapsedTime,heroAppearanceDuration:l}),i.platforms.map(e=>(0,a.jsx)(ew,{platform:e,gameAreaHeight:v.height,paddingTop:0},e.id)),i.activeCoins.map(e=>(0,a.jsx)(e_,{coin:e,gameAreaHeight:v.height,paddingTop:0},e.id)),i.enemies.map(e=>(0,a.jsx)(eT,{enemy:e,gameAreaHeight:v.height,paddingTop:0},e.id))]})}),(0,a.jsx)(eb.Lt,{open:h,onOpenChange:e=>{!e&&u?L():e&&!h&&(g(!0),f(!0))},children:(0,a.jsxs)(eb.EO,{children:[(0,a.jsxs)(eb.wd,{className:"items-center",children:[(0,a.jsx)("div",{className:"relative w-24 h-24 mb-4 bg-contain bg-no-repeat bg-center",style:{backgroundImage:"url(/assets/images/SimplyMan.png)"},role:"img","aria-label":"Simply Man","data-ai-hint":"man thinking cartoon"}),(0,a.jsx)(eb.r7,{children:"Вы действительно хотите покинуть игру?"})]}),(0,a.jsxs)(eb.ck,{className:"flex-col-reverse sm:flex-col-reverse gap-y-2.5",children:[(0,a.jsx)(ed.$,{variant:"destructive",onClick:L,className:"w-full sm:w-auto",children:"Нет, остаться"}),(0,a.jsx)(ed.$,{variant:"secondary",onClick:E,className:"w-full sm:w-auto",children:"Да, покинуть"})]})]})}),(0,a.jsx)("div",{className:"w-full shrink-0",style:{height:"".concat(x,"px")},children:(0,a.jsx)(ef,{dispatch:s,onExit:()=>{f(!0),g(!0)},disabled:"appearing"===i.heroAppearance||i.levelCompleteScreenActive||i.gameLost||i.gameOver||h,currentLevel:i.currentLevel})})]})}},3738:(e,r,i)=>{Promise.resolve().then(i.bind(i,599))}},e=>{var r=r=>e(e.s=r);e.O(0,[797,576,933,441,684,358],()=>r(3738)),_N_E=e.O()}]);