(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[833],{10:(e,t,a)=>{"use strict";a.d(t,{$v:()=>f,EO:()=>p,Lt:()=>s,Rx:()=>v,ck:()=>h,r7:()=>g,tv:()=>c,wd:()=>u});var r=a(5155),i=a(2115),o=a(7830),n=a(9434),l=a(285);let s=o.bL,c=o.l9,d=o.ZL,m=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(o.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in data-[state=open]:duration-500",a),...i,ref:t})});m.displayName=o.hJ.displayName;let p=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(m,{}),(0,r.jsx)(o.UC,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i})]})});p.displayName=o.UC.displayName;let u=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};u.displayName="AlertDialogHeader";let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="AlertDialogFooter";let g=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(o.hE,{ref:t,className:(0,n.cn)("text-lg font-semibold",a),...i})});g.displayName=o.hE.displayName;let f=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(o.VY,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...i})});f.displayName=o.VY.displayName;let v=i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(o.rc,{ref:t,className:(0,n.cn)((0,l.r)(),a),...i})});v.displayName=o.rc.displayName,i.forwardRef((e,t)=>{let{className:a,...i}=e;return(0,r.jsx)(o.ZD,{ref:t,className:(0,n.cn)((0,l.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...i})}).displayName=o.ZD.displayName},157:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(2115);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)((e,t)=>{let{color:a="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:m,...p}=e;return(0,r.createElement)("svg",{ref:t,...n,width:i,height:i,stroke:a,strokeWidth:s?24*Number(l)/Number(i):l,className:o("lucide",c),...p},[...m.map(e=>{let[t,a]=e;return(0,r.createElement)(t,a)}),...Array.isArray(d)?d:[d]])}),s=(e,t)=>{let a=(0,r.forwardRef)((a,n)=>{let{className:s,...c}=a;return(0,r.createElement)(l,{ref:n,iconNode:t,className:o("lucide-".concat(i(e)),s),...c})});return a.displayName="".concat(e),a}},285:(e,t,a)=>{"use strict";a.d(t,{$:()=>c,r:()=>s});var r=a(5155),i=a(2115),o=a(9708),n=a(2085),l=a(9434);let s=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,t)=>{let{className:a,variant:i,size:n,asChild:c=!1,...d}=e,m=c?o.DX:"button";return(0,r.jsx)(m,{className:(0,l.cn)(s({variant:i,size:n,className:a})),ref:t,...d})});c.displayName="Button"},940:(e,t,a)=>{"use strict";a.d(t,{W:()=>p});let r={Hero_jump1:{src:"/assets/sounds/Hero_jump1.mp3",volume:.5},Hero_fail:{src:"/assets/sounds/Hero_fail.mp3",volume:.6},Coin_splash:{src:"/assets/sounds/Coin_splash.mp3",volume:.4},takecoin:{src:"/assets/sounds/takecoin.mp3",volume:.5},allcoins:{src:"/assets/sounds/allcoins.mp3",volume:.7},First_screen:{src:"/assets/sounds/First_screen.mp3",loop:!0,volume:.3},New_level:{src:"/assets/sounds/New_level.mp3",volume:.6},Level1:{src:"/assets/sounds/Level1.mp3",loop:!0,volume:.25},Level2:{src:"/assets/sounds/Level2.mp3",loop:!0,volume:.25},Level3:{src:"/assets/sounds/Level3.mp3",loop:!0,volume:.25},final_screen:{src:"/assets/sounds/final_screen.mp3",loop:!0,volume:.4},bear_voice:{src:"/assets/sounds/bear_voice.mp3",volume:.7},exit:{src:"/assets/sounds/exit.mp3",volume:.6}},i={},o=!1,n=!1,l=null,s=()=>{if(!n){for(let e in r)if(!i[e])try{let t=r[e],a=new Audio(t.src);a.loop=!1,a.volume=void 0!==t.volume?t.volume:1,a.preload="auto",i[e]=a,t.loop&&a.addEventListener("ended",function(){l===e&&(this.currentTime=0,this.play().catch(t=>console.warn("[AudioManager] Custom loop restart for ".concat(e," failed:"),t.name,t.message)))})}catch(t){console.error("[AudioManager] Error preloading sound ".concat(e,":"),t)}n=!0}},c=()=>new Promise(e=>{if(o){e();return}try{let e=window.AudioContext||window.webkitAudioContext;if(e){let t=new e;"suspended"===t.state&&t.resume().then(()=>{}).catch(e=>console.warn("[AudioManager] AudioContext resume on creation failed:",e))}}catch(e){}let t=i.dummy_sound_for_init;t||((t=new Audio("data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")).muted=!0,i.dummy_sound_for_init=t);let a=t.play();void 0!==a?a.then(()=>{t.pause(),o=!0,e()}).catch(t=>{console.warn("[AudioManager] Dummy audio play for context init failed:",t.name,t.message),e()}):(o=!0,e())}),d=async e=>{if(n||s(),!o)try{await c()}catch(t){console.error('[AudioManager] Fallback initAudio process encountered an issue for "'.concat(e,'":'),t)}let t=i[e];if(t){let a=r[e];if(null==a?void 0:a.loop){if(l===e&&!t.paused)return;l&&l!==e&&i[l]&&m(l),l=e}t.currentTime=0;let n=t.play();void 0!==n&&n.catch(a=>{"AbortError"===a.name||("NotAllowedError"!==a.name||o)&&console.error('[AudioManager] Error playing sound "'.concat(e,'" (src: ').concat(t.src,"):"),a.name,a.message)})}},m=e=>{let t=i[e];t&&(t.pause(),t.currentTime=0,l===e&&(l=null))},p={preloadSounds:s,initAudio:c,playSound:d,stopSound:m,stopAllSounds:()=>{for(let e in i){if("dummy_sound_for_init"===e)continue;let t=i[e];t&&(t.pause(),t.currentTime=0)}l=null},setVolume:(e,t)=>{let a=i[e];a&&(a.volume=Math.max(0,Math.min(1,t)))},isInitialized:()=>o,getCurrentPlayingLoop:()=>l&&i[l]&&!i[l].paused?l:null}},2342:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>O});var r=a(5155),i=a(2115),o=a(5695);let n="/assets/images/platform_grass.png",l="/assets/images/platform_ice.png",s="/assets/images/platform_stone.png";var c=a(940);let d=(-.4+Math.sqrt(.4*.4+800))/2,m=e=>0,p={id:"hero",x:0,y:0,width:30,height:80,velocity:{x:0,y:0},action:"idle",isOnPlatform:!0,platformId:"platform_ground",currentSpeedX:0,facingDirection:"right",animations:{idle:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80},run:{src:"/assets/images/hero_jeans3.png",frames:1,fps:10,width:30,height:80},jump:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80}},currentFrame:0,frameTime:0,slideVelocityX:0,isArmored:!1,armorTimer:0,armorCooldownTimer:0,armorRemainingTime:0},u=(e,t,a)=>{let r=m(t),i=.75,o=!1,c=!1,d=n,p=n,u="/assets/images/groundfloor.png";return 1===a?(d=n,p=n,u="/assets/images/groundfloor.png"):2===a?(i=.75,o=!0,c=!0,d=l,p=l,u=l):3===a&&(i=.75,o=!1,c=!0,d=s,p=s,u=s),[{id:"platform_ground",x:-100,y:r,width:e+200,height:1,isMoving:!1,speed:0,direction:1,moveAxis:"x",imageSrc:u},{id:"platform1",x:+e-130,y:r+1+175,width:130,height:24,isMoving:!0,speed:i,direction:-1,moveAxis:"x",moveRange:{min:0,max:e-130},imageSrc:d,isSlippery:o},{id:"platform2",x:0*e-0,y:r+1+375,width:130,height:24,isMoving:!0,speed:i,direction:1,moveAxis:"x",moveRange:{min:0,max:e-130},imageSrc:p,isSlippery:c}]},h=(e,t,a,r)=>{let i=[],o=r.find(e=>"platform1"===e.id),n=r.find(e=>"platform2"===e.id),l=t/2-24;if(o&&n){let e=o.y+o.height;l=e+(n.y-e)/2-24}if(2===a)i.push({id:"enemy_level2_0",enemyId:"enemy1",x:e/2-24,y:l,width:48,height:48,imageSrc:"/assets/images/bearface.png",speed:.4,direction:1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3});else if(3===a&&(i.push({id:"enemy_level3_0",enemyId:"enemy1",x:e/3-24,y:l,width:48,height:48,imageSrc:"/assets/images/bearface.png",speed:.4,direction:1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3}),n)){let t=n.y+n.height+50;i.push({id:"enemy_level3_1",enemyId:"enemy2",x:2*e/3-24,y:t,width:48,height:48,imageSrc:"/assets/images/bearface_dark.png",speed:.4,direction:-1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3})}return i};function g(e,t,a,r){let i,o;if(!e.width||!e.height||0===r.length)return[];c.W.playSound("Coin_splash");let n=[];m(e.height);let l=550-t;200>=(l=Math.min(l,e.height-t))&&(console.warn("Coin spawn zone is invalid. Min:",200,"Max:",l,"GameArea H:",e.height,"CoinSize:",t,"MAX_COIN_SPAWN_Y_FROM_CP_TOP:",550),(l=200+t)+t>e.height-1&&(l=e.height-t-1-t)<200&&(l=200));let s=Math.max(0,l-200),d=.25*e.width,p=Math.max(20,.15*e.height),u=Math.random()*(e.width-t),h=200+(s>0?Math.random()*s:0);n.push({id:"coin_p".concat(a,"_0_").concat(Date.now()),x:u,y:h,width:t,height:t,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!0,spawnExplosionProgress:0,pairId:a,isPendingSpawn:!1,spawnDelayMs:0});let g=0;do i=Math.random()*(e.width-t),o=200+(s>0?Math.random()*s:0),g++;while((Math.abs(i-u)<d||Math.abs(o-h)<p)&&g<20);return n.push({id:"coin_p".concat(a,"_1_").concat(Date.now()),x:i,y:o,width:t,height:t,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!1,spawnExplosionProgress:0,pairId:a,isPendingSpawn:!0,spawnDelayMs:500}),n}let f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=m(t),i=u(e,t,a),o=h(e,t,a,i),n=.75;(2===a||3===a)&&(n=.75);let l=i.map(e=>e.isMoving?{...e,speed:n}:e),s=2===a?7e3:12e3*(3===a);return{hero:{...p,x:e/2-p.width/2,y:r+1,currentSpeedX:0,isArmored:2===a||3===a,armorTimer:s,armorCooldownTimer:0,armorRemainingTime:Math.ceil(s/1e3)},platforms:l,activeCoins:g({width:e,height:t},20,0,l),enemies:o,score:0,currentLevel:a,gameOver:!1,gameLost:!1,gameArea:{width:e,height:t},isGameInitialized:!1,paddingTop:0,heroAppearance:"appearing",heroAppearElapsedTime:0,totalCoinsCollectedInLevel:0,currentPairIndex:0,levelCompleteScreenActive:!1,showDebugLevelComplete:!1,bearVoicePlayedForLevel:!1}},v=f(void 0,void 0,1);function x(e,t){var a,r,i,o,n,l,s,p,u;switch(t.type){case"MOVE_LEFT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:-1.25,action:"run_left",facingDirection:"left",slideVelocityX:0}};return e;case"MOVE_LEFT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX<0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(r=null===(a=e.hero.velocity)||void 0===a?void 0:a.y)&&void 0!==r?r:0)===0?"idle":e.hero.action}};return e;case"MOVE_RIGHT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:1.25,action:"run_right",facingDirection:"right",slideVelocityX:0}};return e;case"MOVE_RIGHT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX>0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(o=null===(i=e.hero.velocity)||void 0===i?void 0:i.y)&&void 0!==o?o:0)===0?"idle":e.hero.action}};return e;case"JUMP":if("visible"===e.heroAppearance&&e.hero.isOnPlatform&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return c.W.playSound("Hero_jump1"),{...e,hero:{...e.hero,velocity:{...e.hero.velocity,y:d},isOnPlatform:!1,platformId:null,action:"jump_up"}};return e;case"UPDATE_GAME_AREA":{let{width:a,height:r,paddingTop:i}=t.payload;if(a<=0||r<=0)return e;let o=e.currentLevel>1?e.currentLevel:1;return{...f(a,r,e.isGameInitialized?e.currentLevel:o),paddingTop:i,isGameInitialized:!0,bearVoicePlayedForLevel:!1}}case"RESTART_LEVEL":{let{width:t,height:a}=e.gameArea;return{...f(t,a,e.currentLevel),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"NEXT_LEVEL":{let t=e.currentLevel+1;if(t>3)return c.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};let{width:a,height:r}=e.gameArea;return{...f(a,r,t),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_WON":return c.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};case"SET_DEBUG_LEVEL_COMPLETE":return{...e,levelCompleteScreenActive:t.payload,showDebugLevelComplete:t.payload};case"SET_DEBUG_LEVEL":{let{width:a,height:r}=e.gameArea,i=f(a,r,t.payload);return v=i,{...i,isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_TICK":{if(!e.isGameInitialized||e.levelCompleteScreenActive||e.gameLost||e.gameOver)return e;let{deltaTime:a}=t.payload,{hero:r,platforms:i,activeCoins:o,enemies:d,score:f,totalCoinsCollectedInLevel:v,currentPairIndex:x,bearVoicePlayedForLevel:y}=e,w=e.gameArea,b=e.heroAppearance,A=e.heroAppearElapsedTime,_=i.map(e=>({...e})),S={...r,velocity:{...r.velocity},animations:{...r.animations}},T=o.map(e=>({...e})),E=[...d.map(e=>({...e}))],M=f,L=v,k=x,j=!1,C=!1,N=!1,z=y;(2===e.currentLevel||3===e.currentLevel)&&(S.isArmored?(S.armorTimer-=a,S.armorTimer<=0&&(S.isArmored=!1,S.armorTimer=0,S.armorCooldownTimer=2===e.currentLevel?7e3:1e4)):(S.armorCooldownTimer-=a,S.armorCooldownTimer<=0&&(S.isArmored=!0,S.armorCooldownTimer=0,S.armorTimer=2===e.currentLevel?7e3:12e3)),S.armorRemainingTime=Math.ceil(S.armorTimer/1e3));let P="run_left"===S.action||"run_right"===S.action?"run":"jump_up"===S.action||"fall_down"===S.action?"jump":"idle",I=S.animations[P];S.frameTime+=a,I&&S.frameTime>=1e3/I.fps&&(S.frameTime=0,S.currentFrame=(S.currentFrame+1)%I.frames),T=(T=(T=T.map(e=>{if(e.isPendingSpawn&&void 0!==e.spawnDelayMs){let t=e.spawnDelayMs-a;return t<=0?(c.W.playSound("Coin_splash"),{...e,isPendingSpawn:!1,spawnDelayMs:0,isSpawning:!0,spawnExplosionProgress:0}):{...e,spawnDelayMs:t}}return e})).map(e=>{if(e.isSpawning){let t=(e.spawnExplosionProgress||0)+a/300;return t>=1?{...e,isSpawning:!1,spawnExplosionProgress:1}:{...e,spawnExplosionProgress:t}}return e})).map(e=>{if(e.isExploding&&e.collected){let t=(e.explosionProgress||0)+a/500;return t>=1?{...e,isExploding:!1,explosionProgress:1}:{...e,explosionProgress:t}}return e});let O=m(w.height);if(_=_.map(e=>{if("platform_ground"===e.id)return{...e,y:O};if(e.isMoving&&"platform_ground"!==e.id){let t=e.x,r=e.speed,i=r*e.direction;"x"===e.moveAxis&&e.moveRange&&((t+=a/(1e3/60)*i)<=e.moveRange.min||t+e.width>=e.moveRange.max+e.width)&&(e.direction*=-1,i*=-1,t=Math.max(e.moveRange.min,Math.min(t,e.moveRange.max)));let o=O+1+("platform1"===e.id?175:375);return{...e,x:t,y:o,velocity:{x:i,y:0},speed:r}}return{...e,velocity:{x:0,y:0}}}),E=E.map(t=>{let r={...t},i=e.enemies.find(e=>e.id===t.id);if(r.isDefeated&&void 0!==r.defeatTimer){let e=r.defeatTimer-a;if(!(e<=0))return{...r,defeatTimer:e};r={...r,isDefeated:!1,defeatTimer:0,x:w.width/2-r.width/2,y:r.y,direction:1,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3},i&&i.isDefeated&&!r.isDefeated&&c.W.playSound("bear_voice")}if(r.isFrozen&&void 0!==r.frozenTimer){let e=r.frozenTimer-a;if(!(e<=0))return{...r,frozenTimer:e};r={...r,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3}}if(!r.isDefeated&&!r.isFrozen&&void 0!==r.periodicFreezeIntervalTimer){let e=r.periodicFreezeIntervalTimer-a;if(e<=0)return{...r,isFrozen:!0,frozenTimer:5e3,periodicFreezeIntervalTimer:5e3};r={...r,periodicFreezeIntervalTimer:e}}if(!r.isDefeated&&!r.isFrozen){let e=r.x,t=r.speed,i=t*r.direction;if("x"===r.moveAxis&&r.moveRange&&((e+=a/(1e3/60)*i)<=r.moveRange.min||e+r.width>=r.moveRange.max+r.width)){let t=-1*r.direction;i*=-1,e=Math.max(r.moveRange.min,Math.min(e,r.moveRange.max)),r={...r,direction:t}}r={...r,x:e,velocity:{x:i,y:0},speed:t}}return r}),"appearing"===e.heroAppearance)(A+=a)>=1e3&&(b="visible",A=1e3,S.action="idle"),S.velocity={x:0,y:0},S.currentSpeedX=0,S.facingDirection=r.facingDirection||"right",S.slideVelocityX=0;else{let t;let r=(null!==(s=null===(n=S.velocity)||void 0===n?void 0:n.y)&&void 0!==s?s:0)-a/(1e3/60)*.4;r=Math.max(r,-8);let i=0,o=!1;if(S.isOnPlatform&&S.platformId){let e=_.find(e=>e.id===S.platformId);e&&(e.isMoving&&(null===(p=e.velocity)||void 0===p?void 0:p.x)&&(i=e.velocity.x*(a/(1e3/60))),e.isSlippery&&(o=!0))}let d=0!==S.currentSpeedX?S.currentSpeedX>0?1.25:-1.25:0;o?(0!==S.currentSpeedX?S.slideVelocityX=d:(S.slideVelocityX=.92*(S.slideVelocityX||0),.1>Math.abs(S.slideVelocityX||0)&&(S.slideVelocityX=0)),t=S.x+(S.slideVelocityX||0)*(a/(1e3/60))+i):(S.slideVelocityX=0,t=S.x+a/(1e3/60)*d+i);let m=S.y+a/(1e3/60)*r;r<-.2?S.action="fall_down":r>0?S.action="jump_up":0!==S.currentSpeedX&&S.isOnPlatform?S.action="right"===S.facingDirection?"run_right":"run_left":S.isOnPlatform&&(0===S.slideVelocityX||!o)?S.action="idle":S.isOnPlatform&&o&&0!==S.slideVelocityX&&(S.action=S.slideVelocityX>0?"run_right":"run_left");let f=!1,v=null,y=r,P=S.y;for(let e of _){let a=t,r=t+S.width,i=m,o=m+S.height,n=e.y+e.height,l=e.y,s=e.x;if(a<e.x+e.width&&r>s){if(y<=0&&P>=n&&i<=n){m=n,y=0,f=!0,v=e.id,("fall_down"===S.action||"jump_up"===S.action)&&(S.action=0!==S.currentSpeedX?"right"===S.facingDirection?"run_right":"run_left":"idle",e.isSlippery&&0===S.currentSpeedX||e.isSlippery||(S.slideVelocityX=0));break}let t=S.y+S.height;y>0&&t<=l&&o>=l&&(m=l-S.height,y=-.2)}}if(S.x=t,S.y=m,S.velocity={x:null!==(u=null===(l=S.velocity)||void 0===l?void 0:l.x)&&void 0!==u?u:0,y:y},S.isOnPlatform=f,S.platformId=v,S.isOnPlatform){let e=_.find(e=>e.id===S.platformId);(null==e?void 0:e.isSlippery)?0===S.currentSpeedX&&.1>Math.abs(S.slideVelocityX||0)?S.action="idle":Math.abs(S.slideVelocityX||0)>=.1&&(S.action=(S.slideVelocityX||0)>0?"run_right":"run_left"):0===S.currentSpeedX&&0===y?S.action="idle":0!==S.currentSpeedX&&0===y&&(S.action="right"===S.facingDirection?"run_right":"run_left")}else y>0?S.action="jump_up":y<-.2&&(S.action="fall_down");S.x<0&&(S.x=0),S.x+S.width>w.width&&(S.x=w.width-S.width),S.y+S.height>w.height&&(S.y=w.height-S.height,S.velocity&&S.velocity.y>0&&(S.velocity.y=0));for(let t=0;t<E.length;t++){let a=E[t];if(a.isDefeated||a.isFrozen)continue;let r=a.x+a.width/2,i=a.y+a.height/2,o=Math.max(S.x,Math.min(r,S.x+S.width)),n=Math.max(S.y,Math.min(i,S.y+S.height)),l=r-o,s=i-n;if(l*l+s*s<a.collisionRadius*a.collisionRadius){S.isArmored||(N=!0,c.W.playSound("Hero_fail"));let r=e.enemies.find(e=>e.id===a.id);r&&!r.isDefeated&&c.W.playSound("bear_voice"),E[t]={...a,isDefeated:!0,defeatTimer:5e3,isFrozen:!1,frozenTimer:0},S.isArmored&&(N=!1);break}}N&&!S.isArmored&&(S.y=O+1,S.x=w.width/2-S.width/2,S.velocity={x:0,y:0},S.isOnPlatform=!0,S.platformId="platform_ground",S.action="idle",b="appearing",A=0,S.slideVelocityX=0);let I=!1,R=0;if(!N||N&&S.isArmored){T=T.map(e=>!e.collected&&!e.isExploding&&!e.isSpawning&&!e.isPendingSpawn&&S.x<e.x+e.width&&S.x+S.width>e.x&&S.y<e.y+e.height&&S.y+S.height>e.y?(I=!0,R++,c.W.playSound("takecoin"),{...e,collected:!0,isExploding:!0,explosionProgress:0}):e);let t=!1;if(I){M+=R;let a=L;if(L+=R,2===e.currentLevel&&0===a&&L>0&&!E.some(e=>"enemy_level2_0"===e.id&&!e.isDefeated)&&!E.find(e=>"enemy_level2_0"===e.id)){let t=h(w.width,w.height,e.currentLevel,_).find(e=>"enemy_level2_0"===e.id);t&&(z||(c.W.playSound("bear_voice"),z=!0),E.push(t))}if(3===e.currentLevel&&0===a&&L>0&&0===E.filter(e=>e.id.startsWith("enemy_level3_")&&!e.isDefeated).length){let t=h(w.width,w.height,e.currentLevel,_),a=!1;t.forEach(e=>{E.some(t=>t.id===e.id)||(E.push(e),a=!0)}),a&&!z&&(c.W.playSound("bear_voice"),z=!0)}if(2===e.currentLevel)E=E.map(e=>"enemy_level2_0"!==e.id||e.isDefeated?e:{...e,isFrozen:!0,frozenTimer:5e3});else if(3===e.currentLevel){let e=L%2==0;E=E.map(t=>("enemy1"!==t.enemyId||!e||t.isDefeated)&&("enemy2"!==t.enemyId||e||t.isDefeated)?t:{...t,isFrozen:!0,frozenTimer:5e3})}let r=T.filter(e=>e.pairId===x);r.length>0&&r.every(e=>e.collected)&&(L<10?(k=x+1,t=!0):(j=!0,c.W.playSound("allcoins")))}T=T.filter(e=>!(e.collected&&!1===e.isExploding&&1===e.explosionProgress)),t&&(T=[...T,...g(w,20,k,_)])}!(S.y<0)||j||N&&!S.isArmored||(C=!0,c.W.playSound("Hero_fail"))}let R=e.gameOver,F=e.levelCompleteScreenActive;return!j||N&&!S.isArmored||C||(3===e.currentLevel?R=!0:F=!0),{...e,hero:S,platforms:_,activeCoins:T,enemies:E,score:M,totalCoinsCollectedInLevel:L,currentPairIndex:k,heroAppearance:b,heroAppearElapsedTime:A,gameOver:R,gameLost:C&&!(N&&!S.isArmored),levelCompleteScreenActive:F,bearVoicePlayedForLevel:z}}case"EXIT_GAME":return{...v=f(e.gameArea.width,e.gameArea.height,1),gameOver:!1,gameLost:!1,levelCompleteScreenActive:!1};default:return e}}var y=a(285),w=a(157);let b=(0,w.A)("CircleArrowLeft",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}]]),A=(0,w.A)("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),_=(0,w.A)("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),S=(0,w.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);function T(e){let{dispatch:t,onExit:a,disabled:i=!1,currentLevel:o}=e,n=e=>{i||t({type:e})},l=e=>{i||t({type:e})},s=e=>{t({type:e})},c="p-3 h-16 w-16 rounded-full text-foreground shadow-lg hover:shadow-xl active:shadow-lg active:translate-y-px transition-all duration-150 ease-in-out",d="disabled:opacity-70 disabled:bg-transparent disabled:border disabled:border-destructive disabled:text-destructive disabled:shadow-none disabled:cursor-not-allowed",m=e=>e?{}:{backgroundImage:"radial-gradient(circle, hsl(var(--destructive)), #e74210, #f48c25 )"};return(0,r.jsxs)("div",{className:"h-full w-full p-2 flex items-center justify-around z-50 touch-manipulation",style:{backgroundImage:(e=>{switch(e){case 1:default:return'url("/assets/images/groundfloor.png")';case 2:return'url("/assets/images/platform_ice.png")';case 3:return'url("/assets/images/platform_metal.png")'}})(o),backgroundSize:"cover",backgroundPosition:"center left",backgroundRepeat:"no-repeat",backgroundColor:"transparent"},"data-ai-hint":"stone texture",children:[(0,r.jsx)(y.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(i?d:""),style:m(i),onMouseDown:()=>l("MOVE_LEFT_START"),onMouseUp:()=>s("MOVE_LEFT_STOP"),onTouchStart:()=>l("MOVE_LEFT_START"),onTouchEnd:()=>s("MOVE_LEFT_STOP"),"aria-label":"Move Left",disabled:i,children:(0,r.jsx)(b,{className:"h-12 w-12 text-foreground"})}),(0,r.jsx)(y.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(i?d:""),style:m(i),onClick:()=>n("JUMP"),"aria-label":"Jump",disabled:i,children:(0,r.jsx)(A,{className:"h-12 w-12 text-foreground"})}),(0,r.jsx)(y.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(i?d:""),style:m(i),onMouseDown:()=>l("MOVE_RIGHT_START"),onMouseUp:()=>s("MOVE_RIGHT_STOP"),onTouchStart:()=>l("MOVE_RIGHT_START"),onTouchEnd:()=>s("MOVE_RIGHT_STOP"),"aria-label":"Move Right",disabled:i,children:(0,r.jsx)(_,{className:"h-12 w-12 text-foreground"})}),(0,r.jsx)(y.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(i?d:""),style:m(i),onClick:a,"aria-label":"Выход в меню",disabled:i,children:(0,r.jsx)(S,{className:"h-12 w-12 text-foreground"})})]})}var E=a(9434);function M(e){let{x:t,y:a,width:r,height:i,gameAreaHeight:o,paddingTop:n,color:l,heroAction:s,heroFacingDirection:c,appearanceProps:d,shape:m="rect",isHero:p=!1,isPlatform:u=!1,isEnemy:h=!1}=e,g={position:"absolute",left:"".concat(t,"px"),top:"".concat(n+(o-a-i),"px"),width:"".concat(r,"px"),height:"".concat(i,"px"),objectFit:"fill",transition:"opacity 0.2s ease-out, transform 0.2s ease-out, filter 0.2s ease-out"};l&&!h&&(g.backgroundColor=l);let f="";p&&(f="left"===c?"scaleX(-1)":"scaleX(1)");let v="";if((null==d?void 0:d.type)==="heroAppear"){let e=d.progress;g.opacity=e,v="scale(".concat(e,")"),g.transformOrigin="center bottom",g.borderRadius="2px"}else if("circle"===m?g.borderRadius="50%":h||(g.borderRadius="2px"),s)switch(s){case"jump_up":v="scaleY(0.95) translateY(-3px) scaleX(1.05)",g.transition="transform 0.1s ease-out";break;case"fall_down":v="scaleY(1.05) translateY(1px) scaleX(0.95)",g.transition="transform 0.1s ease-in";break;default:v=""}let x="".concat(f," ").concat(v).trim();return x&&(g.transform=x),g}function L(e){let t,{hero:a,gameAreaHeight:i,paddingTop:o,heroAppearance:n,heroAppearElapsedTime:l,heroAppearanceDuration:s}=e;if(!i&&0!==i)return null;"appearing"===n&&(t={type:"heroAppear",progress:Math.min(1,l/s)});let c=a.animations.idle.src,d=a.animations.run.src,m=a.animations.jump.src,p=c,u="character fantasy";"run_left"===a.action||"run_right"===a.action?(p=d,u="character running"):("jump_up"===a.action||"fall_down"===a.action)&&(p=m,u="character jumping");let h=M({...a,gameAreaHeight:i,paddingTop:o,heroAction:a.action,heroFacingDirection:a.facingDirection,appearanceProps:t,isHero:!0}),g=[];return a.isArmored&&g.push("hero-armored"),(0,r.jsx)("img",{src:p,alt:"Hero",style:h,className:(0,E.cn)(g),role:"img","aria-label":"Hero","data-ai-hint":u})}function k(e){let{platform:t,gameAreaHeight:a,paddingTop:i}=e;if(!a&&0!==a)return null;let o={...M({...t,gameAreaHeight:a,paddingTop:i,color:void 0,shape:"rect",isPlatform:!0}),backgroundImage:"url(".concat(t.imageSrc||n,")"),backgroundSize:"platform_ground"===t.id?"auto 100%":"100% 100%",backgroundPosition:"platform_ground"===t.id?"left bottom":"center",backgroundRepeat:"platform_ground"===t.id?"repeat-x":"no-repeat",boxShadow:"none",border:"none"},l="grass platform";return t.imageSrc&&(t.imageSrc.includes("groundfloor")?l="stone ground":t.imageSrc.includes("ice")?l="ice platform":t.imageSrc.includes("stone")?l="stone platform":t.imageSrc.includes("grass")&&(l="grass platform")),(0,r.jsx)("div",{style:o,role:"presentation","data-ai-hint":l})}function j(e){let{coin:t,gameAreaHeight:a,paddingTop:i}=e;if(!a&&0!==a)return null;let o=M({...t,gameAreaHeight:a,paddingTop:i,shape:"circle"});if(t.isSpawning&&null!=t.spawnExplosionProgress&&t.spawnExplosionProgress<1){let e=[];for(let a=0;a<8;a++){let i=a/8*2*Math.PI+(Math.random()-.5)*.5,o=40*t.spawnExplosionProgress*(.5+.5*Math.random()),n=Math.cos(i)*o,l=Math.sin(i)*o,s={position:"absolute",left:"calc(50% + ".concat(n,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--accent))",borderRadius:"50%",opacity:1-t.spawnExplosionProgress,transform:"scale(".concat(1-t.spawnExplosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,r.jsx)("div",{style:s},"spawn_particle_".concat(a)))}let a={position:"absolute",left:o.left,top:o.top,width:o.width,height:o.height};return(0,r.jsx)("div",{style:a,"aria-label":"Coin Spawning","data-ai-hint":"sparkle effect",children:e})}if(t.isExploding&&t.collected&&null!=t.explosionProgress&&t.explosionProgress<1){let e=[];for(let a=0;a<8;a++){let i=a/8*2*Math.PI+(Math.random()-.5)*.5,o=40*t.explosionProgress*(.5+.5*Math.random()),n=Math.cos(i)*o,l=Math.sin(i)*o,s={position:"absolute",left:"calc(50% + ".concat(n,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--coin-color))",borderRadius:"50%",opacity:1-t.explosionProgress,transform:"scale(".concat(1-t.explosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,r.jsx)("div",{style:s},"collect_particle_".concat(a)))}let a={position:"absolute",left:o.left,top:o.top,width:o.width,height:o.height};return(0,r.jsx)("div",{style:a,"aria-label":"Coin Exploding","data-ai-hint":"gold sparkle",children:e})}return t.collected||t.isSpawning?null:(0,r.jsx)("img",{src:"/assets/images/thankscoin.png",alt:"Coin",className:"animate-rotate-y",style:{...o,transformStyle:"preserve-3d",boxShadow:"2px 2px 3px rgba(0,0,0,0.2), inset 0 0 2px rgba(255,255,255,0.3)"},role:"img","aria-label":"Coin","data-ai-hint":"gold coin"})}function C(e){let{enemy:t,gameAreaHeight:a,paddingTop:i}=e;if(!a&&0!==a||t.isDefeated&&t.defeatTimer>0)return null;let o=M({...t,gameAreaHeight:a,paddingTop:i,isEnemy:!0,isDefeated:t.isDefeated});return(0,r.jsx)("img",{src:t.imageSrc,alt:"Enemy",style:o,role:"img","aria-label":"Enemy","data-ai-hint":"enemy2"===t.enemyId?"dark bear face":"bear face"})}let N=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--coin-color))","hsl(var(--hero-color))","#FFD700","#FF69B4","#00FFFF","#DA70D6","#FF7F50"];function z(e){let{currentLevel:t,onNextLevel:a}=e,[o,n]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let e=()=>{let e=[];for(let t=0;t<5;t++){let a=10+80*Math.random(),r=10+80*Math.random();for(let i=0;i<12;i++){let o=Math.random()*Math.PI*2,n=20*Math.random()+10,l=Math.cos(o)*n,s=Math.sin(o)*n,c=180/Math.PI*Math.atan2(s,l)-90;e.push({id:Date.now()+12*t+i+Math.random(),originX:"".concat(a,"%"),originY:"".concat(r,"%"),targetOffsetX:"".concat(l,"vmin"),targetOffsetY:"".concat(s,"vmin"),size:(2+2*Math.random())*4,color:N[Math.floor(Math.random()*N.length)],delay:1.4*Math.random(),duration:1.2+.8*Math.random(),trailAngle:c})}}n(e)};e();let t=setInterval(e,3500);return()=>clearInterval(t)},[]),(0,r.jsxs)("div",{className:"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50 p-4 animate-in fade-in duration-1000",style:{backgroundImage:"url(/assets/images/wallpaper1.jpg)",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat"},"aria-modal":"true",role:"dialog","aria-labelledby":"level-complete-title","data-ai-hint":"abstract celebration",children:[(0,r.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none z-0",children:[" ",o.map(e=>(0,r.jsx)("div",{className:"firework-particle",style:{left:e.originX,top:e.originY,backgroundColor:e.color,"--tx":e.targetOffsetX,"--ty":e.targetOffsetY,animationDelay:"".concat(e.delay,"s"),animationDuration:"".concat(e.duration,"s"),"--particle-initial-size":"".concat(e.size,"px"),"--trail-angle":"".concat(e.trailAngle,"deg")}},e.id))]}),(0,r.jsxs)("div",{className:"bg-card text-card-foreground p-8 rounded-xl shadow-2xl text-center z-10 transform transition-all animate-in fade-in zoom-in-90 duration-1000",children:[" ",(0,r.jsx)("div",{className:"mx-auto mb-4 h-32 w-32 relative rounded-full animate-image-glow bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/assets/images/superman.png)"},role:"img","aria-label":"Superman character","data-ai-hint":"superhero character"}),(0,r.jsx)("h2",{id:"level-complete-title",className:"text-3xl md:text-4xl font-bold mb-3 text-primary",children:"Поздравляем!"}),(0,r.jsxs)("p",{className:"text-xl md:text-2xl mb-8 text-foreground/90",children:["Вы прошли уровень ",t,"!"]}),(0,r.jsxs)(y.$,{onClick:a,size:"lg",className:"text-lg px-8 py-3 bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200","aria-label":"Перейти на уровень ".concat(t+1),children:["Уровень ",t+1]})]})]})}function P(){let e=(0,o.useRouter)();return(0,i.useEffect)(()=>(c.W.stopAllSounds(),c.W.playSound("final_screen"),()=>{c.W.stopSound("final_screen")}),[]),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center text-foreground animate-in fade-in duration-1000",style:{backgroundImage:"url(/assets/images/final.png)",backgroundSize:"cover",backgroundPosition:"center"},"data-ai-hint":"victory celebration achievement",role:"img","aria-label":"Final Screen Background",children:(0,r.jsxs)("div",{className:"bg-card/70 backdrop-blur-sm text-card-foreground p-8 rounded-xl shadow-2xl text-center max-w-md w-full transform transition-all animate-in fade-in zoom-in-90 duration-1000",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-primary mb-4",children:"Поздравляем!"}),(0,r.jsx)("p",{className:"text-xl text-foreground/90 mb-2",children:"Главный приз - ваш!"}),(0,r.jsx)("p",{className:"text-xl text-foreground/90 mb-2",children:"Смело идите на IPO!"}),(0,r.jsx)("p",{className:"text-xl text-foreground/90 mb-8",children:"Вас ждет успех!"}),(0,r.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,r.jsx)(y.$,{onClick:()=>{c.W.stopSound("final_screen"),e.push("/")},variant:"destructive",size:"lg",className:"text-lg py-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Играть снова"}),(0,r.jsx)(y.$,{onClick:()=>{c.W.stopSound("final_screen");try{let t=window.open("","_self");null==t||t.close(),t&&(!1===t.closed||void 0===t.closed)?(console.warn("Could not close the tab automatically. Navigating to the entry page."),e.push("/")):t||(console.warn("Could not open reference to close tab. Navigating to the entry page."),e.push("/"))}catch(t){console.error("Error attempting to close tab:",t),e.push("/")}},variant:"outline",size:"lg",className:"text-lg py-3 shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200",children:"Закрыть игру"})]})]})})}var I=a(10);function O(){var e;let{gameState:t,dispatch:a,gameTick:n}=function(){let[e,t]=(0,i.useReducer)(x,v),a=(0,i.useRef)(performance.now()),r=(0,i.useCallback)(()=>{let e=performance.now(),r=e-a.current;a.current=e,t({type:"GAME_TICK",payload:{deltaTime:r}})},[]),o=(0,i.useCallback)(e=>{t(e)},[]);return(0,i.useEffect)(()=>{e.gameArea.width>0&&e.gameArea.height>0&&!e.isGameInitialized&&t({type:"UPDATE_GAME_AREA",payload:{width:e.gameArea.width,height:e.gameArea.height,paddingTop:e.paddingTop}})},[e.gameArea.width,e.gameArea.height,e.isGameInitialized,e.paddingTop]),{gameState:e,dispatch:o,gameTick:r}}(),l=(0,i.useRef)(null),s=(0,i.useRef)(),d=(0,o.useRouter)(),[m,p]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[g,f]=(0,i.useState)(!1),[w,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{},[a]);let A=(0,i.useCallback)(()=>{if(l.current){let{clientWidth:e,clientHeight:t}=l.current;a({type:"UPDATE_GAME_AREA",payload:{width:e,height:t,paddingTop:0}})}},[a]);(0,i.useEffect)(()=>(A(),window.addEventListener("resize",A),()=>{window.removeEventListener("resize",A),c.W.stopAllSounds(),s.current&&cancelAnimationFrame(s.current)}),[A]),(0,i.useEffect)(()=>{if(t.isGameInitialized){c.W.stopAllSounds(),c.W.playSound("New_level");let e={1:"Level1",2:"Level2",3:"Level3"}[t.currentLevel];e&&c.W.getCurrentPlayingLoop()!==e&&setTimeout(()=>{t.isGameInitialized&&t.currentLevel===parseInt(e.replace("Level",""))&&c.W.playSound(e)},500)}},[t.currentLevel,t.isGameInitialized]);let _=(0,i.useCallback)(()=>{!t.isGameInitialized||!(t.gameArea.width>0)||!(t.gameArea.height>0)||t.levelCompleteScreenActive||t.gameOver||t.gameLost||w||n(),s.current=requestAnimationFrame(_)},[n,t.isGameInitialized,t.gameArea.width,t.gameArea.height,t.levelCompleteScreenActive,t.gameOver,t.gameLost,w]);(0,i.useEffect)(()=>(w?s.current&&cancelAnimationFrame(s.current):s.current=requestAnimationFrame(_),()=>{s.current&&cancelAnimationFrame(s.current)}),[_,w]),(0,i.useEffect)(()=>{let e=e=>{if(g||m||"appearing"===t.heroAppearance||t.levelCompleteScreenActive||t.gameLost||t.gameOver||"F5"===e.key||e.ctrlKey&&"r"===e.key.toLowerCase()||e.ctrlKey&&e.shiftKey&&"i"===e.key.toLowerCase()||e.metaKey&&e.altKey&&"i"===e.key.toLowerCase()||"F12"===e.key)return;let r=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":a({type:"MOVE_LEFT_START"}),r=!0;break;case"arrowright":case"d":a({type:"MOVE_RIGHT_START"}),r=!0;break;case"arrowup":case"w":case" ":a({type:"JUMP"}),r=!0}r&&e.preventDefault()},r=e=>{if(g||m||"appearing"===t.heroAppearance||t.levelCompleteScreenActive||t.gameLost||t.gameOver)return;let r=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":a({type:"MOVE_LEFT_STOP"}),r=!0;break;case"arrowright":case"d":a({type:"MOVE_RIGHT_STOP"}),r=!0}r&&e.preventDefault()};return window.addEventListener("keydown",e),window.addEventListener("keyup",r),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",r),a({type:"MOVE_LEFT_STOP"}),a({type:"MOVE_RIGHT_STOP"})}},[a,t.heroAppearance,t.levelCompleteScreenActive,t.gameLost,t.gameOver,m,g]);let S=async()=>{c.W.stopAllSounds(),c.W.playSound("exit"),f(!1),b(!1),setTimeout(()=>{d.push("/")},300)},E=()=>{f(!1),b(!1)};return m?(0,r.jsx)(P,{}):t.gameLost?(0,r.jsxs)("div",{className:"h-screen w-screen flex flex-col items-center justify-center bg-background text-foreground p-4",children:[(0,r.jsx)("h2",{className:"text-4xl font-bold mb-4 text-destructive",children:"Игра окончена!"}),(0,r.jsx)("p",{className:"text-xl mb-8 text-center",children:"Кажется, наш герой немного увлекся полетом..."}),(0,r.jsx)(y.$,{onClick:()=>{c.W.stopAllSounds(),a({type:"RESTART_LEVEL"})},size:"lg",className:"text-lg px-8 py-3 bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Начать сначала"}),(0,r.jsx)(y.$,{onClick:S,variant:"outline",size:"lg",className:"mt-4 text-lg px-8 py-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Главное меню"})]}):t.levelCompleteScreenActive||u?(0,r.jsx)(z,{currentLevel:t.currentLevel,onNextLevel:()=>{c.W.stopAllSounds(),a({type:"NEXT_LEVEL"}),u&&h(!1)}}):t.gameOver&&3===t.currentLevel&&!t.gameLost?(0,r.jsx)(P,{}):(0,r.jsxs)("div",{className:"h-screen w-screen flex flex-col overflow-hidden select-none",style:{backgroundColor:"hsl(var(--background))",paddingBottom:"0px",boxSizing:"border-box"},"aria-label":"Главное окно игры",children:[(0,r.jsxs)("header",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-10 pointer-events-none",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"font-roboto text-2xl font-bold text-white shadow-md",children:"IPO Mad Racing"}),(null===(e=t.hero)||void 0===e?void 0:e.isArmored)&&t.hero.armorRemainingTime>0&&(0,r.jsxs)("p",{className:"text-xs font-normal text-accent font-roboto shadow-md",children:["Броня: ",t.hero.armorRemainingTime,"с"]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end",children:[(0,r.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Level: ",t.currentLevel]}),(0,r.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Спасибки: ",t.score]})]})]}),(0,r.jsx)("div",{ref:l,className:"relative w-full overflow-hidden flex-grow bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(".concat((e=>{switch(e){case 1:default:return"/assets/images/BackGroundBase.png";case 2:return"/assets/images/level2_bkg.png";case 3:return"/assets/images/level3_bkg.png"}})(t.currentLevel),")"),backgroundSize:"cover",backgroundPosition:"center",height:"calc(100% - 10vh)"},"data-ai-hint":"abstract pattern",children:t.isGameInitialized&&t.gameArea.height>0&&t.hero&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L,{hero:t.hero,gameAreaHeight:t.gameArea.height,paddingTop:t.paddingTop,heroAppearance:t.heroAppearance,heroAppearElapsedTime:t.heroAppearElapsedTime,heroAppearanceDuration:1e3}),t.platforms.map(e=>(0,r.jsx)(k,{platform:e,gameAreaHeight:t.gameArea.height,paddingTop:t.paddingTop},e.id)),t.activeCoins.map(e=>(0,r.jsx)(j,{coin:e,gameAreaHeight:t.gameArea.height,paddingTop:t.paddingTop},e.id)),t.enemies.map(e=>(0,r.jsx)(C,{enemy:e,gameAreaHeight:t.gameArea.height,paddingTop:t.paddingTop},e.id))]})}),(0,r.jsx)(I.Lt,{open:g,onOpenChange:e=>{!e&&w?E():e&&!g&&(f(!0),b(!0))},children:(0,r.jsxs)(I.EO,{children:[(0,r.jsxs)(I.wd,{className:"items-center",children:[(0,r.jsx)("div",{className:"relative w-24 h-24 mb-4 bg-contain bg-no-repeat bg-center",style:{backgroundImage:"url(/assets/images/SimplyMan.png)"},role:"img","aria-label":"Simply Man","data-ai-hint":"man thinking cartoon"}),(0,r.jsx)(I.r7,{children:"Вы действительно хотите покинуть игру?"})]}),(0,r.jsxs)(I.ck,{className:"flex-col-reverse sm:flex-col-reverse gap-y-2.5",children:[(0,r.jsx)(y.$,{variant:"destructive",onClick:E,className:"w-full sm:w-auto",children:"Нет, остаться"}),(0,r.jsx)(y.$,{variant:"secondary",onClick:S,className:"w-full sm:w-auto",children:"Да, покинуть"})]})]})}),(0,r.jsxs)("div",{className:"w-full shrink-0",style:{height:"10vh"},children:[" ",(0,r.jsx)(T,{dispatch:a,onExit:()=>{b(!0),f(!0)},disabled:"appearing"===t.heroAppearance||t.levelCompleteScreenActive||t.gameLost||t.gameOver||g,currentLevel:t.currentLevel})]})]})}},3738:(e,t,a)=>{Promise.resolve().then(a.bind(a,2342))},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var r=a(2596),i=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,i.QP)((0,r.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[797,576,441,684,358],()=>t(3738)),_N_E=e.O()}]);