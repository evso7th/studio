(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[833],{157:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var i=t(2115);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,i.forwardRef)((e,r)=>{let{color:t="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:c="",children:d,iconNode:m,...p}=e;return(0,i.createElement)("svg",{ref:r,...o,width:a,height:a,stroke:t,strokeWidth:s?24*Number(l)/Number(a):l,className:n("lucide",c),...p},[...m.map(e=>{let[r,t]=e;return(0,i.createElement)(r,t)}),...Array.isArray(d)?d:[d]])}),s=(e,r)=>{let t=(0,i.forwardRef)((t,o)=>{let{className:s,...c}=t;return(0,i.createElement)(l,{ref:o,iconNode:r,className:n("lucide-".concat(a(e)),s),...c})});return t.displayName="".concat(e),t}},599:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>R});var i=t(5155),a=t(2115),n=t(5695);let o="/assets/images/platform_grass.png",l="/assets/images/platform_ice.png",s="/assets/images/platform_stone.png";var c=t(940);let d=(-.4+Math.sqrt(.4*.4+800))/2,m=e=>0,p={id:"hero",x:0,y:0,width:30,height:80,velocity:{x:0,y:0},action:"idle",isOnPlatform:!0,platformId:"platform_ground",currentSpeedX:0,facingDirection:"right",animations:{idle:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80},run:{src:"/assets/images/hero_jeans3.png",frames:1,fps:10,width:30,height:80},jump:{src:"/assets/images/hero_jeans3.png",frames:1,fps:1,width:30,height:80}},currentFrame:0,frameTime:0,slideVelocityX:0,isArmored:!1,armorTimer:0,armorCooldownTimer:0,armorRemainingTime:0},h=(e,r,t)=>{let i=m(r),a=.75,n=!1,c=!1,d=o,p=o,h="/assets/images/groundfloor.png";return 1===t?(d=o,p=o,h="/assets/images/groundfloor.png"):2===t?(a=.75,n=!0,c=!0,d=l,p=l,h=l):3===t&&(a=.75,n=!1,c=!0,d=s,p=s,h=s),[{id:"platform_ground",x:-100,y:i,width:e+200,height:1,isMoving:!1,speed:0,direction:1,moveAxis:"x",imageSrc:h},{id:"platform1",x:0*e-0,y:i+1+200,width:130,height:24,isMoving:!0,speed:a,direction:1,moveAxis:"x",moveRange:{min:0,max:e-130},imageSrc:d,isSlippery:n},{id:"platform2",x:+e-130,y:i+1+400,width:130,height:24,isMoving:!0,speed:a,direction:-1,moveAxis:"x",moveRange:{min:0,max:e-130},imageSrc:p,isSlippery:c}]},g=(e,r,t,i)=>{let a=[],n=i.find(e=>"platform1"===e.id),o=i.find(e=>"platform2"===e.id),l=r/2-24;if(n&&o){let e=n.y+n.height;l=e+(o.y-e)/2-24}if(2===t)a.push({id:"enemy_level2_0",enemyId:"enemy1",x:e/2-24,y:l,width:48,height:48,imageSrc:"/assets/images/bearface.png",speed:.4,direction:1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3});else if(3===t&&(a.push({id:"enemy_level3_0",enemyId:"enemy1",x:e/3-24,y:l,width:48,height:48,imageSrc:"/assets/images/bearface.png",speed:.4,direction:1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3}),o)){let r=o.y+o.height+50;a.push({id:"enemy_level3_1",enemyId:"enemy2",x:2*e/3-24,y:r,width:48,height:48,imageSrc:"/assets/images/bearface_dark.png",speed:.4,direction:-1,moveAxis:"x",moveRange:{min:0,max:e-48},collisionRadius:24,isDefeated:!1,defeatTimer:0,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3})}return a};function u(e,r,t,i){let a,n;if(!e.width||!e.height||0===i.length)return[];let o=[];m(e.height);let l=550-r;200>=(l=Math.min(l,e.height-r))&&(console.warn("Coin spawn zone is invalid. Min:",200,"Max:",l,"GameArea H:",e.height,"CoinSize:",r,"MAX_COIN_SPAWN_Y_FROM_CP_TOP:",550),(l=200+r)+r>e.height-1&&(l=e.height-r-1-r)<200&&(l=200));let s=Math.max(0,l-200),c=.25*e.width,d=Math.max(20,.15*e.height),p=Math.random()*(e.width-r),h=200+(s>0?Math.random()*s:0);o.push({id:"coin_p".concat(t,"_0_").concat(Date.now()),x:p,y:h,width:r,height:r,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!0,spawnExplosionProgress:0,pairId:t,isPendingSpawn:!1,spawnDelayMs:0});let g=0;do a=Math.random()*(e.width-r),n=200+(s>0?Math.random()*s:0),g++;while((Math.abs(a-p)<c||Math.abs(n-h)<d)&&g<20);return o.push({id:"coin_p".concat(t,"_1_").concat(Date.now()),x:a,y:n,width:r,height:r,collected:!1,isExploding:!1,explosionProgress:0,isSpawning:!1,spawnExplosionProgress:0,pairId:t,isPendingSpawn:!0,spawnDelayMs:500}),o}let f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=m(r),a=h(e,r,t),n=g(e,r,t,a),o=.75;(2===t||3===t)&&(o=.75);let l=a.map(e=>e.isMoving?{...e,speed:o}:e),s=2===t?7e3:12e3*(3===t);return{hero:{...p,x:e/2-p.width/2,y:i+1,currentSpeedX:0,isArmored:2===t||3===t,armorTimer:s,armorCooldownTimer:0,armorRemainingTime:Math.ceil(s/1e3)},platforms:l,activeCoins:u({width:e,height:r},20,0,l),enemies:n,score:0,currentLevel:t,gameOver:!1,gameLost:!1,gameArea:{width:e,height:r},isGameInitialized:!1,paddingTop:0,heroAppearance:"appearing",heroAppearElapsedTime:0,totalCoinsCollectedInLevel:0,currentPairIndex:0,levelCompleteScreenActive:!1,showDebugLevelComplete:!1,bearVoicePlayedForLevel:!1}},v=f(void 0,void 0,1);function y(e,r){var t,i,a,n,o,l,s,p,h;switch(r.type){case"MOVE_LEFT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:-1.25,action:"run_left",facingDirection:"left",slideVelocityX:0}};return e;case"MOVE_LEFT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX<0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(i=null===(t=e.hero.velocity)||void 0===t?void 0:t.y)&&void 0!==i?i:0)===0?"idle":e.hero.action}};return e;case"MOVE_RIGHT_START":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:1.25,action:"run_right",facingDirection:"right",slideVelocityX:0}};return e;case"MOVE_RIGHT_STOP":if("visible"===e.heroAppearance&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return{...e,hero:{...e.hero,currentSpeedX:e.hero.currentSpeedX>0?0:e.hero.currentSpeedX,action:0===e.hero.currentSpeedX&&e.hero.isOnPlatform&&(null!==(n=null===(a=e.hero.velocity)||void 0===a?void 0:a.y)&&void 0!==n?n:0)===0?"idle":e.hero.action}};return e;case"JUMP":if("visible"===e.heroAppearance&&e.hero.isOnPlatform&&!e.levelCompleteScreenActive&&!e.gameLost&&!e.gameOver)return c.W.playSound("Hero_jump1"),{...e,hero:{...e.hero,velocity:{...e.hero.velocity,y:d},isOnPlatform:!1,platformId:null,action:"jump_up"}};return e;case"UPDATE_GAME_AREA":{let{width:t,height:i,paddingTop:a}=r.payload;if(t<=0||i<=0)return e;let n=e.currentLevel>1?e.currentLevel:1;return{...f(t,i,e.isGameInitialized?e.currentLevel:n),paddingTop:a,isGameInitialized:!0,bearVoicePlayedForLevel:!1}}case"RESTART_LEVEL":{let{width:r,height:t}=e.gameArea;return{...f(r,t,e.currentLevel),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"NEXT_LEVEL":{let r=e.currentLevel+1;if(r>3)return c.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};let{width:t,height:i}=e.gameArea;return{...f(t,i,r),isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_WON":return c.W.playSound("final_screen"),{...e,gameOver:!0,levelCompleteScreenActive:!1};case"SET_DEBUG_LEVEL_COMPLETE":return{...e,levelCompleteScreenActive:r.payload,showDebugLevelComplete:r.payload};case"SET_DEBUG_LEVEL":{let{width:t,height:i}=e.gameArea,a=f(t,i,r.payload);return v=a,{...a,isGameInitialized:!0,paddingTop:e.paddingTop,levelCompleteScreenActive:!1,gameOver:!1,bearVoicePlayedForLevel:!1}}case"GAME_TICK":{if(!e.isGameInitialized||e.levelCompleteScreenActive||e.gameLost||e.gameOver)return e;let{deltaTime:t}=r.payload,{hero:i,platforms:a,activeCoins:n,enemies:d,score:f,totalCoinsCollectedInLevel:v,currentPairIndex:y,bearVoicePlayedForLevel:x}=e,w=e.gameArea,_=e.heroAppearance,A=e.heroAppearElapsedTime,b=a.map(e=>({...e})),S={...i,velocity:{...i.velocity},animations:{...i.animations}},T=n.map(e=>({...e})),E=[...d.map(e=>({...e}))],L=f,M=v,C=y,k=!1,P=!1,I=!1,O=x,z=!1;(2===e.currentLevel||3===e.currentLevel)&&(S.isArmored?(S.armorTimer-=t,S.armorTimer<=0&&(S.isArmored=!1,S.armorTimer=0,S.armorCooldownTimer=2===e.currentLevel?7e3:1e4)):(S.armorCooldownTimer-=t,S.armorCooldownTimer<=0&&(S.isArmored=!0,S.armorCooldownTimer=0,S.armorTimer=2===e.currentLevel?7e3:12e3)),S.armorRemainingTime=Math.ceil(S.armorTimer/1e3));let R="run_left"===S.action||"run_right"===S.action?"run":"jump_up"===S.action||"fall_down"===S.action?"jump":"idle",j=S.animations[R];S.frameTime+=t,j&&S.frameTime>=1e3/j.fps&&(S.frameTime=0,S.currentFrame=(S.currentFrame+1)%j.frames),T=(T=T.map(e=>{let r={...e};if(r.isPendingSpawn&&void 0!==r.spawnDelayMs){let e=r.spawnDelayMs-t;e<=0?(z=!0,r={...r,isPendingSpawn:!1,spawnDelayMs:0,isSpawning:!0,spawnExplosionProgress:0}):r.spawnDelayMs=e}if(r.isSpawning){let e=(r.spawnExplosionProgress||0)+t/300;e>=1?(r.isSpawning=!1,r.spawnExplosionProgress=1):r.spawnExplosionProgress=e}return r})).map(e=>{if(e.isExploding&&e.collected){let r=(e.explosionProgress||0)+t/500;return r>=1?{...e,isExploding:!1,explosionProgress:1}:{...e,explosionProgress:r}}return e});let F=m(w.height);if(b=b.map(e=>{if("platform_ground"===e.id)return{...e,y:F};if(e.isMoving&&"platform_ground"!==e.id){let r=e.x,i=e.speed,a=i*e.direction;"x"===e.moveAxis&&e.moveRange&&((r+=t/(1e3/60)*a)<=e.moveRange.min||r+e.width>=e.moveRange.max+e.width)&&(e.direction*=-1,a*=-1,r=Math.max(e.moveRange.min,Math.min(r,e.moveRange.max)));let n=F+1+("platform1"===e.id?200:400);return{...e,x:r,y:n,velocity:{x:a,y:0},speed:i}}return{...e,velocity:{x:0,y:0}}}),E=E.map(r=>{let i={...r},a=e.enemies.find(e=>e.id===r.id);if(i.isDefeated&&void 0!==i.defeatTimer){let e=i.defeatTimer-t;if(!(e<=0))return{...i,defeatTimer:e};i={...i,isDefeated:!1,defeatTimer:0,x:w.width/2-i.width/2,y:i.y,direction:1,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3},a&&a.isDefeated&&!i.isDefeated&&c.W.playSound("bear_voice")}if(i.isFrozen&&void 0!==i.frozenTimer){let e=i.frozenTimer-t;if(!(e<=0))return{...i,frozenTimer:e};i={...i,isFrozen:!1,frozenTimer:0,periodicFreezeIntervalTimer:5e3}}if(!i.isDefeated&&!i.isFrozen&&void 0!==i.periodicFreezeIntervalTimer){let e=i.periodicFreezeIntervalTimer-t;if(e<=0)return{...i,isFrozen:!0,frozenTimer:5e3,periodicFreezeIntervalTimer:5e3};i={...i,periodicFreezeIntervalTimer:e}}if(!i.isDefeated&&!i.isFrozen){let e=i.x,r=i.speed,a=r*i.direction;if("x"===i.moveAxis&&i.moveRange&&((e+=t/(1e3/60)*a)<=i.moveRange.min||e+i.width>=i.moveRange.max+i.width)){let r=-1*i.direction;a*=-1,e=Math.max(i.moveRange.min,Math.min(e,i.moveRange.max)),i={...i,direction:r}}i={...i,x:e,velocity:{x:a,y:0},speed:r}}return i}),"appearing"===e.heroAppearance)(A+=t)>=1e3&&(_="visible",A=1e3,S.action="idle"),S.velocity={x:0,y:0},S.currentSpeedX=0,S.facingDirection=i.facingDirection||"right",S.slideVelocityX=0;else{let r;let i=(null!==(s=null===(o=S.velocity)||void 0===o?void 0:o.y)&&void 0!==s?s:0)-t/(1e3/60)*.4;i=Math.max(i,-8);let a=0,n=!1;if(S.isOnPlatform&&S.platformId){let e=b.find(e=>e.id===S.platformId);e&&(e.isMoving&&(null===(p=e.velocity)||void 0===p?void 0:p.x)&&(a=e.velocity.x*(t/(1e3/60))),e.isSlippery&&(n=!0))}let d=0!==S.currentSpeedX?S.currentSpeedX>0?1.25:-1.25:0;n?(0!==S.currentSpeedX?S.slideVelocityX=d:(S.slideVelocityX=.92*(S.slideVelocityX||0),.1>Math.abs(S.slideVelocityX||0)&&(S.slideVelocityX=0)),r=S.x+(S.slideVelocityX||0)*(t/(1e3/60))+a):(S.slideVelocityX=0,r=S.x+t/(1e3/60)*d+a);let m=S.y+t/(1e3/60)*i;i<-.2?S.action="fall_down":i>0?S.action="jump_up":0!==S.currentSpeedX&&S.isOnPlatform?S.action="right"===S.facingDirection?"run_right":"run_left":S.isOnPlatform&&(0===S.slideVelocityX||!n)?S.action="idle":S.isOnPlatform&&n&&0!==S.slideVelocityX&&(S.action=S.slideVelocityX>0?"run_right":"run_left");let f=!1,v=null,x=i,R=S.y;for(let e of b){let t=r,i=r+S.width,a=m,n=m+S.height,o=e.y+e.height,l=e.y,s=e.x;if(t<e.x+e.width&&i>s){if(x<=0&&R>=o&&a<=o){m=o,x=0,f=!0,v=e.id,("fall_down"===S.action||"jump_up"===S.action)&&(S.action=0!==S.currentSpeedX?"right"===S.facingDirection?"run_right":"run_left":"idle",e.isSlippery&&0===S.currentSpeedX||e.isSlippery||(S.slideVelocityX=0));break}let r=S.y+S.height;x>0&&r<=l&&n>=l&&(m=l-S.height,x=-.2)}}if(S.x=r,S.y=m,S.velocity={x:null!==(h=null===(l=S.velocity)||void 0===l?void 0:l.x)&&void 0!==h?h:0,y:x},S.isOnPlatform=f,S.platformId=v,S.isOnPlatform){let e=b.find(e=>e.id===S.platformId);(null==e?void 0:e.isSlippery)?0===S.currentSpeedX&&.1>Math.abs(S.slideVelocityX||0)?S.action="idle":Math.abs(S.slideVelocityX||0)>=.1&&(S.action=(S.slideVelocityX||0)>0?"run_right":"run_left"):0===S.currentSpeedX&&0===x?S.action="idle":0!==S.currentSpeedX&&0===x&&(S.action="right"===S.facingDirection?"run_right":"run_left")}else x>0?S.action="jump_up":x<-.2&&(S.action="fall_down");S.x<0&&(S.x=0),S.x+S.width>w.width&&(S.x=w.width-S.width),S.y+S.height>w.height&&(S.y=w.height-S.height,S.velocity&&S.velocity.y>0&&(S.velocity.y=0));for(let r=0;r<E.length;r++){let t=E[r];if(t.isDefeated||t.isFrozen)continue;let i=t.x+t.width/2,a=t.y+t.height/2,n=Math.max(S.x,Math.min(i,S.x+S.width)),o=Math.max(S.y,Math.min(a,S.y+S.height)),l=i-n,s=a-o;if(l*l+s*s<t.collisionRadius*t.collisionRadius){S.isArmored||(I=!0,c.W.playSound("Hero_fail"));let i=e.enemies.find(e=>e.id===t.id);i&&!i.isDefeated&&c.W.playSound("bear_voice"),E[r]={...t,isDefeated:!0,defeatTimer:5e3,isFrozen:!1,frozenTimer:0},S.isArmored&&(I=!1);break}}I&&!S.isArmored&&(S.y=F+1,S.x=w.width/2-S.width/2,S.velocity={x:0,y:0},S.isOnPlatform=!0,S.platformId="platform_ground",S.action="idle",_="appearing",A=0,S.slideVelocityX=0);let j=!1,V=0;if(!I||I&&S.isArmored){T=T.map(e=>!e.collected&&!e.isExploding&&!e.isSpawning&&!e.isPendingSpawn&&S.x<e.x+e.width&&S.x+S.width>e.x&&S.y<e.y+e.height&&S.y+S.height>e.y?(j=!0,V++,c.W.playSound("takecoin"),{...e,collected:!0,isExploding:!0,explosionProgress:0}):e);let r=!1;if(j){L+=V;let t=M;if(M+=V,2===e.currentLevel&&0===t&&M>0&&!E.some(e=>"enemy_level2_0"===e.id&&!e.isDefeated)&&!E.find(e=>"enemy_level2_0"===e.id)){let r=g(w.width,w.height,e.currentLevel,b).find(e=>"enemy_level2_0"===e.id);r&&(O||(c.W.playSound("bear_voice"),O=!0),E.push(r))}if(3===e.currentLevel&&0===t&&M>0&&0===E.filter(e=>e.id.startsWith("enemy_level3_")&&!e.isDefeated).length){let r=g(w.width,w.height,e.currentLevel,b),t=!1;r.forEach(e=>{E.some(r=>r.id===e.id)||(E.push(e),t=!0)}),t&&!O&&(c.W.playSound("bear_voice"),O=!0)}if(2===e.currentLevel)E=E.map(e=>"enemy_level2_0"!==e.id||e.isDefeated?e:{...e,isFrozen:!0,frozenTimer:5e3});else if(3===e.currentLevel){let e=M%2==0;E=E.map(r=>("enemy1"!==r.enemyId||!e||r.isDefeated)&&("enemy2"!==r.enemyId||e||r.isDefeated)?r:{...r,isFrozen:!0,frozenTimer:5e3})}let i=T.filter(e=>e.pairId===y);i.length>0&&i.every(e=>e.collected)&&(M<10?(C=y+1,r=!0):(k=!0,c.W.playSound("allcoins")))}T=T.filter(e=>!(e.collected&&!1===e.isExploding&&1===e.explosionProgress)),r&&(T=[...T,...u(w,20,C,b)],z=!0)}z&&c.W.playSound("Coin_splash"),!(S.y<0)||k||I&&!S.isArmored||(P=!0,c.W.playSound("Hero_fail"))}let V=e.gameOver,D=e.levelCompleteScreenActive;return!k||I&&!S.isArmored||P||(3===e.currentLevel?V=!0:D=!0),{...e,hero:S,platforms:b,activeCoins:T,enemies:E,score:L,totalCoinsCollectedInLevel:M,currentPairIndex:C,heroAppearance:_,heroAppearElapsedTime:A,gameOver:V,gameLost:P&&!(I&&!S.isArmored),levelCompleteScreenActive:D,bearVoicePlayedForLevel:O}}case"EXIT_GAME":return{...v=f(e.gameArea.width,e.gameArea.height,1),gameOver:!1,gameLost:!1,levelCompleteScreenActive:!1};default:return e}}var x=t(285),w=t(157);let _=(0,w.A)("CircleArrowLeft",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}]]),A=(0,w.A)("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),b=(0,w.A)("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),S=(0,w.A)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);function T(e){let{dispatch:r,onExit:t,disabled:a=!1,currentLevel:n}=e,o=e=>{a||r({type:e})},l=e=>{a||r({type:e})},s=e=>{r({type:e})},c="p-3 h-16 w-16 rounded-full text-foreground shadow-lg hover:shadow-xl active:shadow-lg active:translate-y-px transition-all duration-150 ease-in-out",d="disabled:opacity-70 disabled:bg-transparent disabled:border disabled:border-destructive disabled:text-destructive disabled:shadow-none disabled:cursor-not-allowed",m=e=>e?{}:{backgroundImage:"radial-gradient(circle, hsl(var(--destructive)), #e74210, #f48c25 )"};return(0,i.jsxs)("div",{className:"h-full w-full p-2 flex items-center justify-around z-50 touch-manipulation",style:{backgroundImage:(e=>{switch(e){case 1:default:return'url("/assets/images/groundfloor.png")';case 2:return'url("/assets/images/platform_ice.png")';case 3:return'url("/assets/images/platform_metal.png")'}})(n),backgroundSize:"cover",backgroundPosition:"center left",backgroundRepeat:"no-repeat",backgroundColor:"transparent"},"data-ai-hint":"stone texture",children:[(0,i.jsx)(x.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(a?d:""),style:m(a),onMouseDown:()=>l("MOVE_LEFT_START"),onMouseUp:()=>s("MOVE_LEFT_STOP"),onTouchStart:()=>l("MOVE_LEFT_START"),onTouchEnd:()=>s("MOVE_LEFT_STOP"),"aria-label":"Move Left",disabled:a,children:(0,i.jsx)(_,{className:"h-12 w-12 text-foreground"})}),(0,i.jsx)(x.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(a?d:""),style:m(a),onClick:()=>o("JUMP"),"aria-label":"Jump",disabled:a,children:(0,i.jsx)(A,{className:"h-12 w-12 text-foreground"})}),(0,i.jsx)(x.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(a?d:""),style:m(a),onMouseDown:()=>l("MOVE_RIGHT_START"),onMouseUp:()=>s("MOVE_RIGHT_STOP"),onTouchStart:()=>l("MOVE_RIGHT_START"),onTouchEnd:()=>s("MOVE_RIGHT_STOP"),"aria-label":"Move Right",disabled:a,children:(0,i.jsx)(b,{className:"h-12 w-12 text-foreground"})}),(0,i.jsx)(x.$,{variant:"ghost",size:"lg",className:"".concat(c," ").concat(a?d:""),style:m(a),onClick:t,"aria-label":"Выход в меню",disabled:a,children:(0,i.jsx)(S,{className:"h-12 w-12 text-foreground"})})]})}var E=t(9434);function L(e){let{x:r,y:t,width:i,height:a,gameAreaHeight:n,paddingTop:o,color:l,heroAction:s,heroFacingDirection:c,appearanceProps:d,shape:m="rect",isHero:p=!1,isPlatform:h=!1,isEnemy:g=!1}=e,u={position:"absolute",left:"".concat(r,"px"),top:"".concat(o+(n-t-a),"px"),width:"".concat(i,"px"),height:"".concat(a,"px"),objectFit:"fill",transition:"opacity 0.2s ease-out, transform 0.2s ease-out, filter 0.2s ease-out"};l&&!g&&(u.backgroundColor=l);let f="";p&&(f="left"===c?"scaleX(-1)":"scaleX(1)");let v="";if((null==d?void 0:d.type)==="heroAppear"){let e=d.progress;u.opacity=e,v="scale(".concat(e,")"),u.transformOrigin="center bottom",u.borderRadius="2px"}else if("circle"===m?u.borderRadius="50%":g||(u.borderRadius="2px"),s)switch(s){case"jump_up":v="scaleY(0.95) translateY(-3px) scaleX(1.05)",u.transition="transform 0.1s ease-out";break;case"fall_down":v="scaleY(1.05) translateY(1px) scaleX(0.95)",u.transition="transform 0.1s ease-in";break;default:v=""}let y="".concat(f," ").concat(v).trim();return y&&(u.transform=y),u}function M(e){let r,{hero:t,gameAreaHeight:a,paddingTop:n,heroAppearance:o,heroAppearElapsedTime:l,heroAppearanceDuration:s}=e;if(!a&&0!==a)return null;"appearing"===o&&(r={type:"heroAppear",progress:Math.min(1,l/s)});let c=t.animations.idle.src,d=t.animations.run.src,m=t.animations.jump.src,p=c,h="character fantasy";"run_left"===t.action||"run_right"===t.action?(p=d,h="character running"):("jump_up"===t.action||"fall_down"===t.action)&&(p=m,h="character jumping");let g=L({...t,gameAreaHeight:a,paddingTop:n,heroAction:t.action,heroFacingDirection:t.facingDirection,appearanceProps:r,isHero:!0}),u=[];return t.isArmored&&u.push("hero-armored"),(0,i.jsx)("img",{src:p,alt:"Hero",style:g,className:(0,E.cn)(u),role:"img","aria-label":"Hero","data-ai-hint":h})}function C(e){let{platform:r,gameAreaHeight:t,paddingTop:a}=e;if(!t&&0!==t)return null;let n={...L({...r,gameAreaHeight:t,paddingTop:a,color:void 0,shape:"rect",isPlatform:!0}),backgroundImage:"url(".concat(r.imageSrc||o,")"),backgroundSize:"platform_ground"===r.id?"auto 100%":"100% 100%",backgroundPosition:"platform_ground"===r.id?"left bottom":"center",backgroundRepeat:"platform_ground"===r.id?"repeat-x":"no-repeat",boxShadow:"none",border:"none"},l="grass platform";return r.imageSrc&&(r.imageSrc.includes("groundfloor")?l="stone ground":r.imageSrc.includes("ice")?l="ice platform":r.imageSrc.includes("stone")?l="stone platform":r.imageSrc.includes("grass")&&(l="grass platform")),(0,i.jsx)("div",{style:n,role:"presentation","data-ai-hint":l})}function k(e){let{coin:r,gameAreaHeight:t,paddingTop:a}=e;if(!t&&0!==t)return null;let n=L({...r,gameAreaHeight:t,paddingTop:a,shape:"circle"});if(r.isSpawning&&null!=r.spawnExplosionProgress&&r.spawnExplosionProgress<1){let e=[];for(let t=0;t<8;t++){let a=t/8*2*Math.PI+(Math.random()-.5)*.5,n=40*r.spawnExplosionProgress*(.5+.5*Math.random()),o=Math.cos(a)*n,l=Math.sin(a)*n,s={position:"absolute",left:"calc(50% + ".concat(o,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--accent))",borderRadius:"50%",opacity:1-r.spawnExplosionProgress,transform:"scale(".concat(1-r.spawnExplosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,i.jsx)("div",{style:s},"spawn_particle_".concat(t)))}let t={position:"absolute",left:n.left,top:n.top,width:n.width,height:n.height};return(0,i.jsx)("div",{style:t,"aria-label":"Coin Spawning","data-ai-hint":"sparkle effect",children:e})}if(r.isExploding&&r.collected&&null!=r.explosionProgress&&r.explosionProgress<1){let e=[];for(let t=0;t<8;t++){let a=t/8*2*Math.PI+(Math.random()-.5)*.5,n=40*r.explosionProgress*(.5+.5*Math.random()),o=Math.cos(a)*n,l=Math.sin(a)*n,s={position:"absolute",left:"calc(50% + ".concat(o,"px - ").concat(2.5,"px)"),top:"calc(50% + ".concat(l,"px - ").concat(2.5,"px)"),width:"".concat(5,"px"),height:"".concat(5,"px"),backgroundColor:"hsl(var(--coin-color))",borderRadius:"50%",opacity:1-r.explosionProgress,transform:"scale(".concat(1-r.explosionProgress,")"),transition:"opacity 0.1s ease-out, transform 0.1s ease-out"};e.push((0,i.jsx)("div",{style:s},"collect_particle_".concat(t)))}let t={position:"absolute",left:n.left,top:n.top,width:n.width,height:n.height};return(0,i.jsx)("div",{style:t,"aria-label":"Coin Exploding","data-ai-hint":"gold sparkle",children:e})}return r.collected||r.isSpawning?null:(0,i.jsx)("img",{src:"/assets/images/thankscoin.png",alt:"Coin",className:"animate-rotate-y",style:{...n,transformStyle:"preserve-3d",boxShadow:"2px 2px 3px rgba(0,0,0,0.2), inset 0 0 2px rgba(255,255,255,0.3)"},role:"img","aria-label":"Coin","data-ai-hint":"gold coin"})}function P(e){let{enemy:r,gameAreaHeight:t,paddingTop:a}=e;if(!t&&0!==t||r.isDefeated&&r.defeatTimer>0)return null;let n=L({...r,gameAreaHeight:t,paddingTop:a,isEnemy:!0,isDefeated:r.isDefeated});return(0,i.jsx)("img",{src:r.imageSrc,alt:"Enemy",style:n,role:"img","aria-label":"Enemy","data-ai-hint":"enemy2"===r.enemyId?"dark bear face":"bear face"})}var I=t(6364),O=t(1575),z=t(10);function R(){var e;let{gameState:r,dispatch:t,gameTick:o}=function(){let[e,r]=(0,a.useReducer)(y,v),t=(0,a.useRef)(performance.now()),i=(0,a.useCallback)(()=>{let e=performance.now(),i=e-t.current;t.current=e,r({type:"GAME_TICK",payload:{deltaTime:i}})},[]),n=(0,a.useCallback)(e=>{r(e)},[]);return(0,a.useEffect)(()=>{e.gameArea.width>0&&e.gameArea.height>0&&!e.isGameInitialized&&r({type:"UPDATE_GAME_AREA",payload:{width:e.gameArea.width,height:e.gameArea.height,paddingTop:e.paddingTop}})},[e.gameArea.width,e.gameArea.height,e.isGameInitialized,e.paddingTop]),{gameState:e,dispatch:n,gameTick:i}}(),l=(0,a.useRef)(null),s=(0,a.useRef)(),d=(0,n.useRouter)(),[m,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[u,f]=(0,a.useState)(!1),[w,_]=(0,a.useState)(!1),[A,b]=(0,a.useState)("0px"),[S,E]=(0,a.useState)("");(0,a.useEffect)(()=>{E(navigator.userAgent)},[]),(0,a.useEffect)(()=>{let e="0px";S&&/YaBrowser/i.test(S)&&(e="32px"),b(e)},[S]);let L=(0,a.useCallback)(()=>{if("undefined"!=typeof document){let e=document.documentElement;e.requestFullscreen?e.requestFullscreen().catch(e=>console.warn("Error attempting to enable full-screen mode: ".concat(e.message," (").concat(e.name,")"))):e.mozRequestFullScreen?e.mozRequestFullScreen().catch(e=>console.warn("Error attempting to enable full-screen mode (Firefox): ".concat(e.message," (").concat(e.name,")"))):e.webkitRequestFullscreen?e.webkitRequestFullscreen().catch(e=>console.warn("Error attempting to enable full-screen mode (WebKit): ".concat(e.message," (").concat(e.name,")"))):e.msRequestFullscreen&&e.msRequestFullscreen().catch(e=>console.warn("Error attempting to enable full-screen mode (IE/Edge): ".concat(e.message," (").concat(e.name,")")))}},[]);(0,a.useEffect)(()=>{r.isGameInitialized&&L()},[r.isGameInitialized,L]);let R=(0,a.useCallback)(()=>{if(l.current){let{clientWidth:e,clientHeight:r}=l.current;t({type:"UPDATE_GAME_AREA",payload:{width:e,height:r,paddingTop:0}})}},[t]);(0,a.useEffect)(()=>(R(),window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R),c.W.stopAllSounds(),s.current&&cancelAnimationFrame(s.current)}),[R]),(0,a.useEffect)(()=>{if(r.isGameInitialized){c.W.stopAllSounds(),c.W.playSound("New_level");let e={1:"Level1",2:"Level2",3:"Level3"}[r.currentLevel];e&&c.W.getCurrentPlayingLoop()!==e&&setTimeout(()=>{r.isGameInitialized&&r.currentLevel===parseInt(e.replace("Level",""))&&c.W.playSound(e)},500)}},[r.currentLevel,r.isGameInitialized]),(0,a.useEffect)(()=>{r.isGameInitialized&&r.activeCoins.length>0&&0===r.currentPairIndex&&r.activeCoins.some(e=>0===e.pairId&&e.isSpawning)},[r.isGameInitialized,r.activeCoins,r.currentPairIndex]);let j=(0,a.useCallback)(()=>{!r.isGameInitialized||!(r.gameArea.width>0)||!(r.gameArea.height>0)||r.levelCompleteScreenActive||r.gameOver||r.gameLost||w||o(),s.current=requestAnimationFrame(j)},[o,r.isGameInitialized,r.gameArea.width,r.gameArea.height,r.levelCompleteScreenActive,r.gameOver,r.gameLost,w]);(0,a.useEffect)(()=>(w?s.current&&cancelAnimationFrame(s.current):s.current=requestAnimationFrame(j),()=>{s.current&&cancelAnimationFrame(s.current)}),[j,w]),(0,a.useEffect)(()=>{let e=e=>{if(u||m||"appearing"===r.heroAppearance||r.levelCompleteScreenActive||r.gameLost||r.gameOver||"F5"===e.key||e.ctrlKey&&"r"===e.key.toLowerCase()||e.ctrlKey&&e.shiftKey&&"i"===e.key.toLowerCase()||e.metaKey&&e.altKey&&"i"===e.key.toLowerCase()||"F12"===e.key)return;let i=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":t({type:"MOVE_LEFT_START"}),i=!0;break;case"arrowright":case"d":t({type:"MOVE_RIGHT_START"}),i=!0;break;case"arrowup":case"w":case" ":t({type:"JUMP"}),i=!0}i&&e.preventDefault()},i=e=>{if(u||m||"appearing"===r.heroAppearance||r.levelCompleteScreenActive||r.gameLost||r.gameOver)return;let i=!1;switch(e.key.toLowerCase()){case"arrowleft":case"a":t({type:"MOVE_LEFT_STOP"}),i=!0;break;case"arrowright":case"d":t({type:"MOVE_RIGHT_STOP"}),i=!0}i&&e.preventDefault()};return window.addEventListener("keydown",e),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",i),t({type:"MOVE_LEFT_STOP"}),t({type:"MOVE_RIGHT_STOP"})}},[t,r.heroAppearance,r.levelCompleteScreenActive,r.gameLost,r.gameOver,m,u]);let F=async()=>{c.W.stopAllSounds(),c.W.playSound("exit"),f(!1),_(!1),setTimeout(()=>{d.push("/")},300)},V=()=>{f(!1),_(!1)};return m?(0,i.jsx)(O.V,{}):r.gameLost?(0,i.jsxs)("div",{className:"h-screen w-screen flex flex-col items-center justify-center bg-background text-foreground p-4",children:[(0,i.jsx)("h2",{className:"text-4xl font-bold mb-4 text-destructive",children:"Игра окончена!"}),(0,i.jsx)("p",{className:"text-xl mb-8 text-center",children:"Кажется, наш герой немного увлекся полетом..."}),(0,i.jsx)(x.$,{onClick:()=>{c.W.stopAllSounds(),t({type:"RESTART_LEVEL"})},size:"lg",className:"text-lg px-8 py-3 bg-primary hover:bg-primary/90 text-primary-foreground shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Начать сначала"}),(0,i.jsx)(x.$,{onClick:F,variant:"outline",size:"lg",className:"mt-4 text-lg px-8 py-3 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200",children:"Главное меню"})]}):r.levelCompleteScreenActive||h?(0,i.jsx)(I.M,{currentLevel:r.currentLevel,onNextLevel:()=>{c.W.stopAllSounds(),t({type:"NEXT_LEVEL"}),h&&g(!1)}}):r.gameOver&&3===r.currentLevel&&!r.gameLost?(0,i.jsx)(O.V,{}):(0,i.jsxs)("div",{className:"h-screen w-screen flex flex-col overflow-hidden select-none",style:{backgroundColor:"hsl(var(--background))",paddingBottom:A,boxSizing:"border-box"},"aria-label":"Главное окно игры",children:[(0,i.jsxs)("header",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-10 pointer-events-none",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"font-roboto text-2xl font-bold text-white shadow-md",children:"IPO Mad Racing"}),(null===(e=r.hero)||void 0===e?void 0:e.isArmored)&&r.hero.armorRemainingTime>0&&(0,i.jsxs)("p",{className:"text-xs font-normal text-accent font-roboto shadow-md",children:["Броня: ",r.hero.armorRemainingTime,"с"]})]}),(0,i.jsxs)("div",{className:"flex flex-col items-end",children:[(0,i.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Level: ",r.currentLevel]}),(0,i.jsxs)("p",{className:"text-xs font-normal text-white font-roboto shadow-md",children:["Спасибки: ",r.score]})]})]}),(0,i.jsx)("div",{ref:l,className:"relative w-full overflow-hidden flex-grow bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(".concat((e=>{switch(e){case 1:default:return"/assets/images/level1_bkg.png";case 2:return"/assets/images/level2_bkg.png";case 3:return"/assets/images/level3_bkg.png"}})(r.currentLevel),")"),backgroundSize:"cover",backgroundPosition:3===r.currentLevel?"top right":"top center",height:"calc(100% - 10vh - ".concat(A,")")},"data-ai-hint":"abstract pattern",children:r.isGameInitialized&&r.gameArea.height>0&&r.hero&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(M,{hero:r.hero,gameAreaHeight:r.gameArea.height,paddingTop:r.paddingTop,heroAppearance:r.heroAppearance,heroAppearElapsedTime:r.heroAppearElapsedTime,heroAppearanceDuration:1e3}),r.platforms.map(e=>(0,i.jsx)(C,{platform:e,gameAreaHeight:r.gameArea.height,paddingTop:r.paddingTop},e.id)),r.activeCoins.map(e=>(0,i.jsx)(k,{coin:e,gameAreaHeight:r.gameArea.height,paddingTop:r.paddingTop},e.id)),r.enemies.map(e=>(0,i.jsx)(P,{enemy:e,gameAreaHeight:r.gameArea.height,paddingTop:r.paddingTop},e.id))]})}),(0,i.jsx)(z.Lt,{open:u,onOpenChange:e=>{!e&&w?V():e&&!u&&(f(!0),_(!0))},children:(0,i.jsxs)(z.EO,{children:[(0,i.jsxs)(z.wd,{className:"items-center",children:[(0,i.jsx)("div",{className:"relative w-24 h-24 mb-4 bg-contain bg-no-repeat bg-center",style:{backgroundImage:"url(/assets/images/SimplyMan.png)"},role:"img","aria-label":"Simply Man","data-ai-hint":"man thinking cartoon"}),(0,i.jsx)(z.r7,{children:"Вы действительно хотите покинуть игру?"})]}),(0,i.jsxs)(z.ck,{className:"flex-col-reverse sm:flex-col-reverse gap-y-2.5",children:[(0,i.jsx)(x.$,{variant:"destructive",onClick:V,className:"w-full sm:w-auto",children:"Нет, остаться"}),(0,i.jsx)(x.$,{variant:"secondary",onClick:F,className:"w-full sm:w-auto",children:"Да, покинуть"})]})]})}),(0,i.jsx)("div",{className:"w-full shrink-0",style:{height:"10vh"},children:(0,i.jsx)(T,{dispatch:t,onExit:()=>{_(!0),f(!0)},disabled:"appearing"===r.heroAppearance||r.levelCompleteScreenActive||r.gameLost||r.gameOver||u,currentLevel:r.currentLevel})})]})}},3738:(e,r,t)=>{Promise.resolve().then(t.bind(t,599))}},e=>{var r=r=>e(e.s=r);e.O(0,[797,576,933,441,684,358],()=>r(3738)),_N_E=e.O()}]);